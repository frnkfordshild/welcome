const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C1pA6XZz.js","assets/index-DSQNeCOl.js","assets/index-VP0MhWOR.css"])))=>i.map(i=>d[i]);
import{l as xi,k as ri,m as mt,n as Bc,q as us,r as Xv,t as em,u as ro,v as ps,w as jh,x as Ht,D as tm,y as im,z as rm,A as Y,N as T,C as hr,E as sm,F as Kc,G as nm,J as om,K as Jn,L as am,M as cm,V as hm,R as um,O as Wc,P as lm,Q as pm,S as dm,T as Gc,$ as fm,U as gm,W as ym,X as cr,Z as Qc,Y as Kt,a0 as vm,a1 as so,a2 as no,a3 as oo,a4 as mm,a5 as z,a6 as ao,a7 as Mh,a8 as lt,a9 as wm,aa as _m,ab as Ei,ac as _e,ad as Le,ae as Ft,af as Vt,ag as Nt,ah as Ve,ai as bm,aj as Ii,ak as zh,al as ar,am as Em,an as Im,ao as Pm,ap as Uh,aq as Sm,ar as kh,as as Vh,at as Pi,au as Yn,av as xm,aw as as,ax as Si,ay as Rm,az as cs,aA as Cm,aB as Om,aC as Am,aD as rs,aE as Tm,aF as Nm,aG as zn,aH as Jc,aI as qm,aJ as $m,aK as Dm,aL as Yc,aM as Lm,aN as jm,aO as Mm,aP as zm,aQ as Um,aR as km,aS as Vm,aT as Fm,aU as Hm,aV as Zc,aW as rr,aX as Fh,aY as Un,aZ as Bm,a_ as Km,_ as Wm}from"./index-DSQNeCOl.js";class Gm extends xi{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class Qm extends xi{constructor(r,i){super(),this.core=r,this.logger=i,this.records=new Map}}class Jm{constructor(r,i){this.logger=r,this.core=i}}let Ym=class extends xi{constructor(r,i){super(),this.relayer=r,this.logger=i}},Zm=class extends xi{constructor(r){super()}},Xm=class{constructor(r,i,n,o){this.core=r,this.logger=i,this.name=n}};class ew extends xi{constructor(r,i){super(),this.relayer=r,this.logger=i}}let tw=class extends xi{constructor(r,i){super(),this.core=r,this.logger=i}},iw=class{constructor(r,i){this.projectId=r,this.logger=i}},rw=class{constructor(r){this.opts=r,this.protocol="wc",this.version=2}},sw=class{constructor(r){this.client=r}};const nw=()=>typeof WebSocket<"u"?WebSocket:typeof ri<"u"&&typeof ri.WebSocket<"u"?ri.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),ow=()=>typeof WebSocket<"u"||typeof ri<"u"&&typeof ri.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Xc=p=>p.split("?")[0],eh=10,aw=nw();class cw{constructor(r){if(this.url=r,this.events=new mt.EventEmitter,this.registering=!1,!Bc(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);this.url=r}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){return new Promise((r,i)=>{if(typeof this.socket>"u"){i(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),r()},this.socket.close()})}async send(r,i){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(us(r))}catch(n){this.onError(r.id,n)}}register(r=this.url){if(!Bc(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=r,this.registering=!0,new Promise((i,n)=>{const o=Xv.isReactNative()?void 0:{rejectUnauthorized:!em(r)},h=new aw(r,[],o);ow()?h.onerror=d=>{const y=d;n(this.emitError(y.error))}:h.on("error",d=>{n(this.emitError(d))}),h.onopen=()=>{this.onOpen(h),i(h)}})}onOpen(r){r.onmessage=i=>this.onPayload(i),r.onclose=i=>this.onClose(i),this.socket=r,this.registering=!1,this.events.emit("open")}onClose(r){this.socket=void 0,this.registering=!1,this.events.emit("close",r)}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?ro(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),h=ps(r,o);this.events.emit("payload",h)}parseError(r,i=this.url){return jh(r,Xc(i),"WS")}resetMaxListeners(){this.events.getMaxListeners()>eh&&this.events.setMaxListeners(eh)}emitError(r){const i=this.parseError(new Error(r?.message||`WebSocket connection failed for host: ${Xc(this.url)}`));return this.events.emit("register_error",i),i}}var hw={};function uw(p,r){if(p.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),n=0;n<i.length;n++)i[n]=255;for(var o=0;o<p.length;o++){var h=p.charAt(o),d=h.charCodeAt(0);if(i[d]!==255)throw new TypeError(h+" is ambiguous");i[d]=o}var y=p.length,b=p.charAt(0),x=Math.log(y)/Math.log(256),q=Math.log(256)/Math.log(y);function $(O){if(O instanceof Uint8Array||(ArrayBuffer.isView(O)?O=new Uint8Array(O.buffer,O.byteOffset,O.byteLength):Array.isArray(O)&&(O=Uint8Array.from(O))),!(O instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(O.length===0)return"";for(var te=0,se=0,ae=0,Pe=O.length;ae!==Pe&&O[ae]===0;)ae++,te++;for(var X=(Pe-ae)*q+1>>>0,J=new Uint8Array(X);ae!==Pe;){for(var ne=O[ae],Se=0,de=X-1;(ne!==0||Se<se)&&de!==-1;de--,Se++)ne+=256*J[de]>>>0,J[de]=ne%y>>>0,ne=ne/y>>>0;if(ne!==0)throw new Error("Non-zero carry");se=Se,ae++}for(var fe=X-se;fe!==X&&J[fe]===0;)fe++;for(var pt=b.repeat(te);fe<X;++fe)pt+=p.charAt(J[fe]);return pt}function D(O){if(typeof O!="string")throw new TypeError("Expected String");if(O.length===0)return new Uint8Array;var te=0;if(O[te]!==" "){for(var se=0,ae=0;O[te]===b;)se++,te++;for(var Pe=(O.length-te)*x+1>>>0,X=new Uint8Array(Pe);O[te];){var J=i[O.charCodeAt(te)];if(J===255)return;for(var ne=0,Se=Pe-1;(J!==0||ne<ae)&&Se!==-1;Se--,ne++)J+=y*X[Se]>>>0,X[Se]=J%256>>>0,J=J/256>>>0;if(J!==0)throw new Error("Non-zero carry");ae=ne,te++}if(O[te]!==" "){for(var de=Pe-ae;de!==Pe&&X[de]===0;)de++;for(var fe=new Uint8Array(se+(Pe-de)),pt=se;de!==Pe;)fe[pt++]=X[de++];return fe}}}function G(O){var te=D(O);if(te)return te;throw new Error(`Non-${r} character`)}return{encode:$,decodeUnsafe:D,decode:G}}var lw=uw,pw=lw;const Hh=p=>{if(p instanceof Uint8Array&&p.constructor.name==="Uint8Array")return p;if(p instanceof ArrayBuffer)return new Uint8Array(p);if(ArrayBuffer.isView(p))return new Uint8Array(p.buffer,p.byteOffset,p.byteLength);throw new Error("Unknown type, must be binary type")},dw=p=>new TextEncoder().encode(p),fw=p=>new TextDecoder().decode(p);class gw{constructor(r,i,n){this.name=r,this.prefix=i,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class yw{constructor(r,i,n){if(this.name=r,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return Bh(this,r)}}class vw{constructor(r){this.decoders=r}or(r){return Bh(this,r)}decode(r){const i=r[0],n=this.decoders[i];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Bh=(p,r)=>new vw({...p.decoders||{[p.prefix]:p},...r.decoders||{[r.prefix]:r}});class mw{constructor(r,i,n,o){this.name=r,this.prefix=i,this.baseEncode=n,this.baseDecode=o,this.encoder=new gw(r,i,n),this.decoder=new yw(r,i,o)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const ds=({name:p,prefix:r,encode:i,decode:n})=>new mw(p,r,i,n),ur=({prefix:p,name:r,alphabet:i})=>{const{encode:n,decode:o}=pw(i,r);return ds({prefix:p,name:r,encode:n,decode:h=>Hh(o(h))})},ww=(p,r,i,n)=>{const o={};for(let q=0;q<r.length;++q)o[r[q]]=q;let h=p.length;for(;p[h-1]==="=";)--h;const d=new Uint8Array(h*i/8|0);let y=0,b=0,x=0;for(let q=0;q<h;++q){const $=o[p[q]];if($===void 0)throw new SyntaxError(`Non-${n} character`);b=b<<i|$,y+=i,y>=8&&(y-=8,d[x++]=255&b>>y)}if(y>=i||255&b<<8-y)throw new SyntaxError("Unexpected end of data");return d},_w=(p,r,i)=>{const n=r[r.length-1]==="=",o=(1<<i)-1;let h="",d=0,y=0;for(let b=0;b<p.length;++b)for(y=y<<8|p[b],d+=8;d>i;)d-=i,h+=r[o&y>>d];if(d&&(h+=r[o&y<<i-d]),n)for(;h.length*i&7;)h+="=";return h},Ce=({name:p,prefix:r,bitsPerChar:i,alphabet:n})=>ds({prefix:r,name:p,encode(o){return _w(o,n,i)},decode(o){return ww(o,n,i,p)}}),bw=ds({prefix:"\0",name:"identity",encode:p=>fw(p),decode:p=>dw(p)});var Ew=Object.freeze({__proto__:null,identity:bw});const Iw=Ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Pw=Object.freeze({__proto__:null,base2:Iw});const Sw=Ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var xw=Object.freeze({__proto__:null,base8:Sw});const Rw=ur({prefix:"9",name:"base10",alphabet:"0123456789"});var Cw=Object.freeze({__proto__:null,base10:Rw});const Ow=Ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Aw=Ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Tw=Object.freeze({__proto__:null,base16:Ow,base16upper:Aw});const Nw=Ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),qw=Ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$w=Ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Dw=Ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Lw=Ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),jw=Ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Mw=Ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zw=Ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Uw=Ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var kw=Object.freeze({__proto__:null,base32:Nw,base32upper:qw,base32pad:$w,base32padupper:Dw,base32hex:Lw,base32hexupper:jw,base32hexpad:Mw,base32hexpadupper:zw,base32z:Uw});const Vw=ur({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Fw=ur({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Hw=Object.freeze({__proto__:null,base36:Vw,base36upper:Fw});const Bw=ur({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Kw=ur({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ww=Object.freeze({__proto__:null,base58btc:Bw,base58flickr:Kw});const Gw=Ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qw=Ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Jw=Ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Yw=Ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Zw=Object.freeze({__proto__:null,base64:Gw,base64pad:Qw,base64url:Jw,base64urlpad:Yw});const Kh=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),Xw=Kh.reduce((p,r,i)=>(p[i]=r,p),[]),e_=Kh.reduce((p,r,i)=>(p[r.codePointAt(0)]=i,p),[]);function t_(p){return p.reduce((r,i)=>(r+=Xw[i],r),"")}function i_(p){const r=[];for(const i of p){const n=e_[i.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${i}`);r.push(n)}return new Uint8Array(r)}const r_=ds({prefix:"ðŸš€",name:"base256emoji",encode:t_,decode:i_});var s_=Object.freeze({__proto__:null,base256emoji:r_}),n_=Wh,th=128,o_=127,a_=~o_,c_=Math.pow(2,31);function Wh(p,r,i){r=r||[],i=i||0;for(var n=i;p>=c_;)r[i++]=p&255|th,p/=128;for(;p&a_;)r[i++]=p&255|th,p>>>=7;return r[i]=p|0,Wh.bytes=i-n+1,r}var h_=Zn,u_=128,ih=127;function Zn(p,n){var i=0,n=n||0,o=0,h=n,d,y=p.length;do{if(h>=y)throw Zn.bytes=0,new RangeError("Could not decode varint");d=p[h++],i+=o<28?(d&ih)<<o:(d&ih)*Math.pow(2,o),o+=7}while(d>=u_);return Zn.bytes=h-n,i}var l_=Math.pow(2,7),p_=Math.pow(2,14),d_=Math.pow(2,21),f_=Math.pow(2,28),g_=Math.pow(2,35),y_=Math.pow(2,42),v_=Math.pow(2,49),m_=Math.pow(2,56),w_=Math.pow(2,63),__=function(p){return p<l_?1:p<p_?2:p<d_?3:p<f_?4:p<g_?5:p<y_?6:p<v_?7:p<m_?8:p<w_?9:10},b_={encode:n_,decode:h_,encodingLength:__},Gh=b_;const rh=(p,r,i=0)=>(Gh.encode(p,r,i),r),sh=p=>Gh.encodingLength(p),Xn=(p,r)=>{const i=r.byteLength,n=sh(p),o=n+sh(i),h=new Uint8Array(o+i);return rh(p,h,0),rh(i,h,n),h.set(r,o),new E_(p,i,r,h)};class E_{constructor(r,i,n,o){this.code=r,this.size=i,this.digest=n,this.bytes=o}}const Qh=({name:p,code:r,encode:i})=>new I_(p,r,i);class I_{constructor(r,i,n){this.name=r,this.code=i,this.encode=n}digest(r){if(r instanceof Uint8Array){const i=this.encode(r);return i instanceof Uint8Array?Xn(this.code,i):i.then(n=>Xn(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Jh=p=>async r=>new Uint8Array(await crypto.subtle.digest(p,r)),P_=Qh({name:"sha2-256",code:18,encode:Jh("SHA-256")}),S_=Qh({name:"sha2-512",code:19,encode:Jh("SHA-512")});var x_=Object.freeze({__proto__:null,sha256:P_,sha512:S_});const Yh=0,R_="identity",Zh=Hh,C_=p=>Xn(Yh,Zh(p)),O_={code:Yh,name:R_,encode:Zh,digest:C_};var A_=Object.freeze({__proto__:null,identity:O_});new TextEncoder,new TextDecoder;const nh={...Ew,...Pw,...xw,...Cw,...Tw,...kw,...Hw,...Ww,...Zw,...s_};({...x_,...A_});function Xh(p){return globalThis.Buffer!=null?new Uint8Array(p.buffer,p.byteOffset,p.byteLength):p}function T_(p=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Xh(globalThis.Buffer.allocUnsafe(p)):new Uint8Array(p)}function eu(p,r,i,n){return{name:p,prefix:r,encoder:{name:p,prefix:r,encode:i},decoder:{decode:n}}}const oh=eu("utf8","u",p=>"u"+new TextDecoder("utf8").decode(p),p=>new TextEncoder().encode(p.substring(1))),kn=eu("ascii","a",p=>{let r="a";for(let i=0;i<p.length;i++)r+=String.fromCharCode(p[i]);return r},p=>{p=p.substring(1);const r=T_(p.length);for(let i=0;i<p.length;i++)r[i]=p.charCodeAt(i);return r}),N_={utf8:oh,"utf-8":oh,hex:nh.base16,latin1:kn,ascii:kn,binary:kn,...nh};function q_(p,r="utf8"){const i=N_[r];if(!i)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Xh(globalThis.Buffer.from(p,"utf-8")):i.decoder.decode(`${i.prefix}${p}`)}const tu="wc",$_=2,co="core",Bt=`${tu}@2:${co}:`,D_={name:co,logger:"error"},L_={database:":memory:"},j_="crypto",ah="client_ed25519_seed",M_=z.ONE_DAY,z_="keychain",U_="0.3",k_="messages",V_="0.3",F_=z.SIX_HOURS,H_="publisher",iu="irn",B_="error",ru="wss://relay.walletconnect.com",ch="wss://relay.walletconnect.org",K_="relayer",Ne={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},W_="_subscription",At={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},G_=z.ONE_SECOND,Q_="2.10.1",J_=1e4,Y_="0.3",Z_="WALLETCONNECT_CLIENT_ID",vt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},X_="subscription",eb="0.3",tb=z.FIVE_SECONDS*1e3,ib="pairing",rb="0.3",Zi={wc_pairingDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:z.ONE_DAY,prompt:!1,tag:0},res:{ttl:z.ONE_DAY,prompt:!1,tag:0}}},sr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},yt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},sb="history",nb="0.3",ob="expirer",st={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},ab="0.3",Vn="verify-api",hs="https://verify.walletconnect.com",hh="https://verify.walletconnect.org";class cb{constructor(r,i){this.core=r,this.logger=i,this.keychain=new Map,this.name=z_,this.version=U_,this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:h}=T("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(h)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=Y.generateChildLogger(i,this.name)}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,kh(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Vh(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class hb{constructor(r,i,n){this.core=r,this.logger=i,this.name=j_,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),h=Kc(o);return nm(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=om();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const h=await this.getClientSeed(),d=Kc(h),y=Jn();return await am(y,o,M_,d)},this.generateSharedKey=(o,h,d)=>{this.isInitialized();const y=this.getPrivateKey(o),b=cm(y,h);return this.setSymKey(b,d)},this.setSymKey=async(o,h)=>{this.isInitialized();const d=h||hm(o);return await this.keychain.set(d,o),d},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,h,d)=>{this.isInitialized();const y=um(d),b=us(h);if(Wc(y)){const D=y.senderPublicKey,G=y.receiverPublicKey;o=await this.generateSharedKey(D,G)}const x=this.getSymKey(o),{type:q,senderPublicKey:$}=y;return lm({type:q,symKey:x,message:b,senderPublicKey:$})},this.decode=async(o,h,d)=>{this.isInitialized();const y=pm(h,d);if(Wc(y)){const b=y.receiverPublicKey,x=y.senderPublicKey;o=await this.generateSharedKey(b,x)}try{const b=this.getSymKey(o),x=dm({symKey:b,encoded:h});return ro(x)}catch(b){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}},this.getPayloadType=o=>{const h=Gc(o);return fm(h.type)},this.getPayloadSenderPublicKey=o=>{const h=Gc(o);return h.senderPublicKey?gm(h.senderPublicKey,ym):void 0},this.core=r,this.logger=Y.generateChildLogger(i,this.name),this.keychain=n||new cb(this.core,this.logger)}get context(){return Y.getLoggerContext(this.logger)}async setPrivateKey(r,i){return await this.keychain.set(r,i),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(ah)}catch{r=Jn(),await this.keychain.set(ah,r)}return q_(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class ub extends Jm{constructor(r,i){super(r,i),this.logger=r,this.core=i,this.messages=new Map,this.name=k_,this.version=V_,this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const h=Pi(o);let d=this.messages.get(n);return typeof d>"u"&&(d={}),typeof d[h]<"u"||(d[h]=o,this.messages.set(n,d),await this.persist()),h},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const h=this.get(n),d=Pi(o);return typeof h[d]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Y.generateChildLogger(r,this.name),this.core=i}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,kh(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Vh(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class lb extends Ym{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.events=new mt.EventEmitter,this.name=H_,this.queue=new Map,this.publishTimeout=z.toMiliseconds(z.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,h)=>{var d;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}});try{const y=h?.ttl||F_,b=Yn(h),x=h?.prompt||!1,q=h?.tag||0,$=h?.id||xm().toString(),D={topic:n,message:o,opts:{ttl:y,relay:b,prompt:x,tag:q,id:$}},G=setTimeout(()=>this.queue.set($,D),this.publishTimeout);try{await await cr(this.rpcPublish(n,o,y,b,x,q,$),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue($),this.relayer.events.emit(Ne.publish,D)}catch(O){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(d=h?.internal)!=null&&d.throwOnFailedPublish)throw this.removeRequestFromQueue($),O;return}finally{clearTimeout(G)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=r,this.logger=Y.generateChildLogger(i,this.name),this.registerEventListeners()}get context(){return Y.getLoggerContext(this.logger)}rpcPublish(r,i,n,o,h,d,y){var b,x,q,$;const D={method:as(o.protocol).publish,params:{topic:r,message:i,ttl:n,prompt:h,tag:d},id:y};return Ht((b=D.params)==null?void 0:b.prompt)&&((x=D.params)==null||delete x.prompt),Ht((q=D.params)==null?void 0:q.tag)&&(($=D.params)==null||delete $.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:D}),this.relayer.request(D)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:i,message:n,opts:o}=r;await this.publish(i,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(hr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ne.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ne.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class pb{constructor(){this.map=new Map,this.set=(r,i)=>{const n=this.get(r);this.exists(r,i)||this.map.set(r,[...n,i])},this.get=r=>this.map.get(r)||[],this.exists=(r,i)=>this.get(r).includes(i),this.delete=(r,i)=>{if(typeof i>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,i))return;const o=n.filter(h=>h!==i);if(!o.length){this.map.delete(r);return}this.map.set(r,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var db=Object.defineProperty,fb=Object.defineProperties,gb=Object.getOwnPropertyDescriptors,uh=Object.getOwnPropertySymbols,yb=Object.prototype.hasOwnProperty,vb=Object.prototype.propertyIsEnumerable,lh=(p,r,i)=>r in p?db(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,Xi=(p,r)=>{for(var i in r||(r={}))yb.call(r,i)&&lh(p,i,r[i]);if(uh)for(var i of uh(r))vb.call(r,i)&&lh(p,i,r[i]);return p},Fn=(p,r)=>fb(p,gb(r));class mb extends ew{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.subscriptions=new Map,this.topicMap=new pb,this.events=new mt.EventEmitter,this.name=X_,this.version=eb,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Bt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const h=Yn(o),d={topic:n,relay:h};this.pending.set(n,d);const y=await this.rpcSubscribe(n,h);return this.onSubscribe(y,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),y}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof o?.id<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,h)=>{const d=new z.Watch;d.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(y),d.stop(this.pendingSubscriptionWatchLabel),o(!0)),d.elapsed(this.pendingSubscriptionWatchLabel)>=tb&&(clearInterval(y),d.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Y.generateChildLogger(i,this.name),this.clientId=""}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,i){let n=!1;try{n=this.getSubscription(r).topic===i}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,i){const n=this.topicMap.get(r);await Promise.all(n.map(async o=>await this.unsubscribeById(r,o,i)))}async unsubscribeById(r,i,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}});try{const o=Yn(n);await this.rpcUnsubscribe(r,i,o);const h=Le("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,i,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(r,i){const n={method:as(i.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await cr(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ne.connection_stalled)}return Pi(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const i=r[0].relay,n={method:as(i.protocol).batchSubscribe,params:{topics:r.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await cr(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ne.connection_stalled)}}rpcUnsubscribe(r,i,n){const o={method:as(n.protocol).unsubscribe,params:{topic:r,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(r,i){this.setSubscription(r,Fn(Xi({},i),{id:r})),this.pending.delete(i.topic)}onBatchSubscribe(r){r.length&&r.forEach(i=>{this.setSubscription(i.id,Xi({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(r,i,n){this.events.removeAllListeners(i),this.hasSubscription(i,r)&&this.deleteSubscription(i,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,i){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:i}),this.addSubscription(r,i))}addSubscription(r,i){this.subscriptions.set(r,Xi({},i)),this.topicMap.set(i.topic,r),this.events.emit(vt.created,i)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const i=this.subscriptions.get(r);if(!i){const{message:n}=T("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}deleteSubscription(r,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:i});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(vt.deleted,Fn(Xi({},n),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(vt.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(vt.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:i}=T("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const i=await this.rpcBatchSubscribe(r);Si(i)&&this.onBatchSubscribe(i.map((n,o)=>Fn(Xi({},r[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(hr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Ne.connect,async()=>{await this.onConnect()}),this.relayer.on(Ne.disconnect,()=>{this.onDisconnect()}),this.events.on(vt.created,async r=>{const i=vt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(vt.deleted,async r=>{const i=vt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const i=setInterval(()=>{this.restartInProgress||(clearInterval(i),r())},this.pollingInterval)})}}var wb=Object.defineProperty,ph=Object.getOwnPropertySymbols,_b=Object.prototype.hasOwnProperty,bb=Object.prototype.propertyIsEnumerable,dh=(p,r,i)=>r in p?wb(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,Eb=(p,r)=>{for(var i in r||(r={}))_b.call(r,i)&&dh(p,i,r[i]);if(ph)for(var i of ph(r))bb.call(r,i)&&dh(p,i,r[i]);return p};class Ib extends Zm{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new mt.EventEmitter,this.name=K_,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async i=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(i)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=i=>{this.onProviderPayload(i)},this.onConnectHandler=()=>{this.events.emit(Ne.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=i=>{this.logger.error(i),this.events.emit(Ne.error,i),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(At.payload,this.onPayloadHandler),this.provider.on(At.connect,this.onConnectHandler),this.provider.on(At.disconnect,this.onDisconnectHandler),this.provider.on(At.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Y.generateChildLogger(r.logger,this.name):Y.pino(Y.getDefaultLoggerOptions({level:r.logger||B_})),this.messages=new ub(this.logger,r.core),this.subscriber=new mb(this,this.logger),this.publisher=new lb(this,this.logger),this.relayUrl=r?.relayUrl||ru,this.projectId=r.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ch}...`),await this.restartTransport(ch)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},J_)}get context(){return Y.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,i,n){this.isInitialized(),await this.publisher.publish(r,i,n),await this.recordMessageEvent({topic:r,message:i,publishedAt:Date.now()})}async subscribe(r,i){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";return o||(await Promise.all([new Promise(h=>{this.subscriber.once(vt.created,d=>{d.topic===r&&h()})}),new Promise(async h=>{o=await this.subscriber.subscribe(r,i),h()})]),o)}async unsubscribe(r,i){this.isInitialized(),await this.subscriber.unsubscribe(r,i)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await cr(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(i=>{if(!this.initialized)return i();this.subscriber.once(vt.resubscribed,()=>{i()})}),new Promise(async(i,n)=>{try{await cr(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}i()})])}catch(i){this.logger.error(i);const n=i;if(!this.isConnectionStalled(n.message))throw i;this.provider.events.emit(At.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Qc())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(i=>r.includes(i))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Kt(new cw(vm({sdkVersion:Q_,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:i,message:n}=r;await this.messages.set(i,n)}async shouldIgnoreMessageEvent(r){const{topic:i,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(i))return this.logger.debug(`Ignoring message for non-subscribed topic ${i}`),!0;const o=this.messages.has(i,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),so(r)){if(!r.method.endsWith(W_))return;const i=r.params,{topic:n,message:o,publishedAt:h}=i.data,d={topic:n,message:o,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Eb({type:"event",event:i.id},d)),this.events.emit(i.id,d),await this.acknowledgePayload(r),await this.onMessageEvent(d)}else no(r)&&this.events.emit(Ne.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Ne.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const i=oo(r.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(At.payload,this.onPayloadHandler),this.provider.off(At.connect,this.onConnectHandler),this.provider.off(At.disconnect,this.onDisconnectHandler),this.provider.off(At.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Ne.connection_stalled,()=>{this.restartTransport().catch(i=>this.logger.error(i))});let r=await Qc();mm(async i=>{this.initialized&&r!==i&&(r=i,i?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Ne.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},z.toMiliseconds(G_)))}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const i=setInterval(()=>{this.connected&&(clearInterval(i),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Pb=Object.defineProperty,fh=Object.getOwnPropertySymbols,Sb=Object.prototype.hasOwnProperty,xb=Object.prototype.propertyIsEnumerable,gh=(p,r,i)=>r in p?Pb(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,yh=(p,r)=>{for(var i in r||(r={}))Sb.call(r,i)&&gh(p,i,r[i]);if(fh)for(var i of fh(r))xb.call(r,i)&&gh(p,i,r[i]);return p};class fs extends Xm{constructor(r,i,n,o=Bt,h=void 0){super(r,i,n,o),this.core=r,this.logger=i,this.name=n,this.map=new Map,this.version=Y_,this.cached=[],this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(d=>{this.getKey&&d!==null&&!Ht(d)?this.map.set(this.getKey(d),d):tm(d)?this.map.set(d.id,d):im(d)&&this.map.set(d.topic,d)}),this.cached=[],this.initialized=!0)},this.set=async(d,y)=>{this.isInitialized(),this.map.has(d)?await this.update(d,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:d,value:y}),this.map.set(d,y),await this.persist())},this.get=d=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:d}),this.getData(d)),this.getAll=d=>(this.isInitialized(),d?this.values.filter(y=>Object.keys(d).every(b=>rm(y[b],d[b]))):this.values),this.update=async(d,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:d,update:y});const b=yh(yh({},this.getData(d)),y);this.map.set(d,b),await this.persist()},this.delete=async(d,y)=>{this.isInitialized(),this.map.has(d)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:d,reason:y}),this.map.delete(d),await this.persist())},this.logger=Y.generateChildLogger(i,this.name),this.storagePrefix=o,this.getKey=h}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const i=this.map.get(r);if(!i){const{message:n}=T("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:i}=T("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Rb{constructor(r,i){this.core=r,this.logger=i,this.name=ib,this.version=rb,this.events=new ao,this.initialized=!1,this.storagePrefix=Bt,this.ignoredPayloadTypes=[Mh],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Jn(),o=await this.core.crypto.setSymKey(n),h=lt(z.FIVE_MINUTES),d={protocol:iu},y={topic:o,expiry:h,relay:d,active:!1},b=wm({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:d});return await this.pairings.set(o,y),await this.core.relayer.subscribe(o),this.core.expirer.set(o,h),{topic:o,uri:b}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:h,relay:d}=_m(n.uri);let y;if(this.pairings.keys.includes(o)&&(y=this.pairings.get(o),y.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(h,o),await this.core.relayer.subscribe(o,{relay:d}));const b=lt(z.FIVE_MINUTES),x={topic:o,relay:d,expiry:b,active:!1};return await this.pairings.set(o,x),this.core.expirer.set(o,b),n.activatePairing&&await this.activate({topic:o}),this.events.emit(sr.create,x),x},this.activate=async({topic:n})=>{this.isInitialized();const o=lt(z.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const h=await this.sendRequest(o,"wc_pairingPing",{}),{done:d,resolve:y,reject:b}=Ei();this.events.once(_e("pairing_ping",h),({error:x})=>{x?b(x):y()}),await d()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",Le("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,h)=>{const d=ar(o,h),y=await this.core.crypto.encode(n,d),b=Zi[o].req;return this.core.history.set(n,d),this.core.relayer.publish(n,y,b),d.id},this.sendResult=async(n,o,h)=>{const d=oo(n,h),y=await this.core.crypto.encode(o,d),b=await this.core.history.get(o,n),x=Zi[b.request.method].res;await this.core.relayer.publish(o,y,x),await this.core.history.resolve(d)},this.sendError=async(n,o,h)=>{const d=ps(n,h),y=await this.core.crypto.encode(o,d),b=await this.core.history.get(o,n),x=Zi[b.request.method]?Zi[b.request.method].res:Zi.unregistered_method.res;await this.core.relayer.publish(o,y,x),await this.core.history.resolve(d)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Le("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>Ft(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:h}=n;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(o,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,h);default:return this.onUnknownRpcMethodRequest(o,h)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:h}=n,d=(await this.core.history.get(o,h.id)).request.method;switch(d){case"wc_pairingPing":return this.onPairingPingResponse(o,h);default:return this.onUnknownRpcMethodResponse(d)}},this.onPairingPingRequest=async(n,o)=>{const{id:h}=o;try{this.isValidPing({topic:n}),await this.sendResult(h,n,!0),this.events.emit(sr.ping,{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onPairingPingResponse=(n,o)=>{const{id:h}=o;setTimeout(()=>{Vt(o)?this.events.emit(_e("pairing_ping",h),{}):Nt(o)&&this.events.emit(_e("pairing_ping",h),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:h}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(sr.delete,{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:h,method:d}=o;try{if(this.registeredMethods.includes(d))return;const y=Le("WC_METHOD_UNSUPPORTED",d);await this.sendError(h,n,y),this.logger.error(y)}catch(y){await this.sendError(h,n,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(Le("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!Ve(n)){const{message:o}=T("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(o)}if(!bm(n.uri)){const{message:o}=T("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(o)}},this.isValidPing=async n=>{if(!Ve(n)){const{message:h}=T("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!Ve(n)){const{message:h}=T("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!Ii(n,!1)){const{message:o}=T("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=T("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(Ft(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=T("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=r,this.logger=Y.generateChildLogger(i,this.name),this.pairings=new fs(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Y.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Ne.message,async r=>{const{topic:i,message:n}=r;if(!this.pairings.keys.includes(i)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(i,n);try{so(o)?(this.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):no(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.core.history.delete(i,o.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(st.expired,async r=>{const{topic:i}=zh(r.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(sr.expire,{topic:i}))})}}class Cb extends Qm{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.records=new Map,this.events=new mt.EventEmitter,this.name=sb,this.version=nb,this.cached=[],this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:h}),this.records.has(o.id))return;const d={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:h,expiry:lt(z.THIRTY_DAYS)};this.records.set(d.id,d),this.events.emit(yt.created,d)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=Nt(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(yt.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(h=>{if(h.topic===n){if(typeof o<"u"&&h.id!==o)return;this.records.delete(h.id),this.events.emit(yt.deleted,h)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Y.generateChildLogger(i,this.name)}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const n={topic:i.topic,request:ar(i.request.method,i.request.params,i.id),chainId:i.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const i=this.records.get(r);if(!i){const{message:n}=T("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(yt.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:i}=T("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(yt.created,r=>{const i=yt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(yt.updated,r=>{const i=yt.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(yt.deleted,r=>{const i=yt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.core.heartbeat.on(hr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{z.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Ob extends tw{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.expirations=new Map,this.events=new mt.EventEmitter,this.name=ob,this.version=ab,this.cached=[],this.initialized=!1,this.storagePrefix=Bt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const h=this.formatTarget(n),d={target:h,expiry:o};this.expirations.set(h,d),this.checkExpiry(h,d),this.events.emit(st.created,{target:h,expiration:d})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),h=this.getExpiration(o);this.expirations.delete(o),this.events.emit(st.deleted,{target:o,expiration:h})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Y.generateChildLogger(i,this.name)}get context(){return Y.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return Em(r);if(typeof r=="number")return Im(r);const{message:i}=T("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(i)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(st.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:i}=T("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const i=this.expirations.get(r);if(!i){const{message:n}=T("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}checkExpiry(r,i){const{expiry:n}=i;z.toMiliseconds(n)-Date.now()<=0&&this.expire(r,i)}expire(r,i){this.expirations.delete(r),this.events.emit(st.expired,{target:r,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,i)=>this.checkExpiry(i,r))}registerEventListeners(){this.core.heartbeat.on(hr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(st.created,r=>{const i=st.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(st.expired,r=>{const i=st.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(st.deleted,r=>{const i=st.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Ab extends iw{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.name=Vn,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||Pm()||!Uh())return;const o=n?.verifyUrl||hs;this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h)}if(!this.initialized){this.removeIframe(),this.verifyUrl=hh;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=n?.verifyUrl||hs;let h;try{h=await this.fetchAttestation(n.attestationId,o)}catch(d){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(d),h=await this.fetchAttestation(n.attestationId,hh)}return h},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const h=this.startAbortTimer(z.ONE_SECOND*2),d=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(h),d.status===200?await d.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(h=>{if(document.getElementById(Vn))return h();window.addEventListener("message",o);const d=document.createElement("iframe");d.id=Vn,d.src=`${this.verifyUrl}/${this.projectId}`,d.style.display="none",document.body.append(d),this.iframe=d,n=h}),new Promise((h,d)=>setTimeout(()=>{window.removeEventListener("message",o),d("verify iframe load timeout")},z.toMiliseconds(z.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Y.generateChildLogger(i,this.name),this.verifyUrl=hs,this.abortController=new AbortController,this.isDevEnv=Sm()&&hw.IS_VITEST}get context(){return Y.getLoggerContext(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),z.toMiliseconds(r))}}var Tb=Object.defineProperty,vh=Object.getOwnPropertySymbols,Nb=Object.prototype.hasOwnProperty,qb=Object.prototype.propertyIsEnumerable,mh=(p,r,i)=>r in p?Tb(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,wh=(p,r)=>{for(var i in r||(r={}))Nb.call(r,i)&&mh(p,i,r[i]);if(vh)for(var i of vh(r))qb.call(r,i)&&mh(p,i,r[i]);return p};class ho extends Gm{constructor(r){super(r),this.protocol=tu,this.version=$_,this.name=co,this.events=new mt.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=r?.projectId,this.relayUrl=r?.relayUrl||ru;const i=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:Y.pino(Y.getDefaultLoggerOptions({level:r?.logger||D_.logger}));this.logger=Y.generateChildLogger(i,this.name),this.heartbeat=new hr.HeartBeat,this.crypto=new hb(this,this.logger,r?.keychain),this.history=new Cb(this,this.logger),this.expirer=new Ob(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new sm(wh(wh({},L_),r?.storageOptions)),this.relayer=new Ib({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Rb(this,this.logger),this.verify=new Ab(this.projectId||"",this.logger)}static async init(r){const i=new ho(r);await i.initialize();const n=await i.crypto.getClientId();return await i.storage.setItem(Z_,n),i}get context(){return Y.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const $b=ho,su="wc",nu=2,ou="client",uo=`${su}@${nu}:${ou}:`,Hn={name:ou,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},_h="WALLETCONNECT_DEEPLINK_CHOICE",Db="proposal",au="Proposal expired",Lb="session",ss=z.SEVEN_DAYS,jb="engine",er={wc_sessionPropose:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1115}}},Bn={min:z.FIVE_MINUTES,max:z.SEVEN_DAYS},Tt={idle:"IDLE",active:"ACTIVE"},Mb="request",zb=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Ub=Object.defineProperty,kb=Object.defineProperties,Vb=Object.getOwnPropertyDescriptors,bh=Object.getOwnPropertySymbols,Fb=Object.prototype.hasOwnProperty,Hb=Object.prototype.propertyIsEnumerable,Eh=(p,r,i)=>r in p?Ub(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,ke=(p,r)=>{for(var i in r||(r={}))Fb.call(r,i)&&Eh(p,i,r[i]);if(bh)for(var i of bh(r))Hb.call(r,i)&&Eh(p,i,r[i]);return p},tr=(p,r)=>kb(p,Vb(r));class Bb extends sw{constructor(r){super(r),this.name=jb,this.events=new ao,this.initialized=!1,this.ignoredPayloadTypes=[Mh],this.requestQueue={state:Tt.idle,queue:[]},this.sessionRequestQueue={state:Tt.idle,queue:[]},this.requestQueueDelay=z.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(er)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay)))},this.connect=async i=>{await this.isInitialized();const n=tr(ke({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:h,optionalNamespaces:d,sessionProperties:y,relays:b}=n;let x=o,q,$=!1;if(x&&($=this.client.core.pairing.pairings.get(x).active),!x||!$){const{topic:X,uri:J}=await this.client.core.pairing.create();x=X,q=J}const D=await this.client.core.crypto.generateKeyPair(),G=ke({requiredNamespaces:h,optionalNamespaces:d,relays:b??[{protocol:iu}],proposer:{publicKey:D,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:O,resolve:te,done:se}=Ei(z.FIVE_MINUTES,au);if(this.events.once(_e("session_connect"),async({error:X,session:J})=>{if(X)O(X);else if(J){J.self.publicKey=D;const ne=tr(ke({},J),{requiredNamespaces:J.requiredNamespaces,optionalNamespaces:J.optionalNamespaces});await this.client.session.set(J.topic,ne),await this.setExpiry(J.topic,J.expiry),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:J.peer.metadata}),te(ne)}}),!x){const{message:X}=T("NO_MATCHING_KEY",`connect() pairing topic: ${x}`);throw new Error(X)}const ae=await this.sendRequest({topic:x,method:"wc_sessionPropose",params:G}),Pe=lt(z.FIVE_MINUTES);return await this.setProposal(ae,ke({id:ae,expiry:Pe},G)),{uri:q,approval:se}},this.pair=async i=>(await this.isInitialized(),await this.client.core.pairing.pair(i)),this.approve=async i=>{await this.isInitialized(),await this.isValidApprove(i);const{id:n,relayProtocol:o,namespaces:h,sessionProperties:d}=i,y=this.client.proposal.get(n);let{pairingTopic:b,proposer:x,requiredNamespaces:q,optionalNamespaces:$}=y;b=b||"",cs(q)||(q=Cm(h,"approve()"));const D=await this.client.core.crypto.generateKeyPair(),G=x.publicKey,O=await this.client.core.crypto.generateSharedKey(D,G);b&&n&&(await this.client.core.pairing.updateMetadata({topic:b,metadata:x.metadata}),await this.sendResult({id:n,topic:b,result:{relay:{protocol:o??"irn"},responderPublicKey:D}}),await this.client.proposal.delete(n,Le("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:b}));const te=ke({relay:{protocol:o??"irn"},namespaces:h,requiredNamespaces:q,optionalNamespaces:$,pairingTopic:b,controller:{publicKey:D,metadata:this.client.metadata},expiry:lt(ss)},d&&{sessionProperties:d});await this.client.core.relayer.subscribe(O),await this.sendRequest({topic:O,method:"wc_sessionSettle",params:te,throwOnFailedPublish:!0});const se=tr(ke({},te),{topic:O,pairingTopic:b,acknowledged:!1,self:te.controller,peer:{publicKey:x.publicKey,metadata:x.metadata},controller:D});return await this.client.session.set(O,se),await this.setExpiry(O,lt(ss)),{topic:O,acknowledged:()=>new Promise(ae=>setTimeout(()=>ae(this.client.session.get(O)),500))}},this.reject=async i=>{await this.isInitialized(),await this.isValidReject(i);const{id:n,reason:o}=i,{pairingTopic:h}=this.client.proposal.get(n);h&&(await this.sendError(n,h,o),await this.client.proposal.delete(n,Le("USER_DISCONNECTED")))},this.update=async i=>{await this.isInitialized(),await this.isValidUpdate(i);const{topic:n,namespaces:o}=i,h=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:d,resolve:y,reject:b}=Ei();return this.events.once(_e("session_update",h),({error:x})=>{x?b(x):y()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:d}},this.extend=async i=>{await this.isInitialized(),await this.isValidExtend(i);const{topic:n}=i,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:h,resolve:d,reject:y}=Ei();return this.events.once(_e("session_extend",o),({error:b})=>{b?y(b):d()}),await this.setExpiry(n,lt(ss)),{acknowledged:h}},this.request=async i=>{await this.isInitialized(),await this.isValidRequest(i);const{chainId:n,request:o,topic:h,expiry:d}=i,y=Fm(),{done:b,resolve:x,reject:q}=Ei(d);return this.events.once(_e("session_request",y),({error:$,result:D})=>{$?q($):x(D)}),await Promise.all([new Promise(async $=>{await this.sendRequest({clientRpcId:y,topic:h,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:d,throwOnFailedPublish:!0}).catch(D=>q(D)),this.client.events.emit("session_request_sent",{topic:h,request:o,chainId:n,id:y}),$()}),new Promise(async $=>{const D=await this.client.core.storage.getItem(_h);Om({id:y,topic:h,wcDeepLink:D}),$()}),b()]).then($=>$[2])},this.respond=async i=>{await this.isInitialized(),await this.isValidRespond(i);const{topic:n,response:o}=i,{id:h}=o;Vt(o)?await this.sendResult({id:h,topic:n,result:o.result,throwOnFailedPublish:!0}):Nt(o)&&await this.sendError(h,n,o.error),this.cleanupAfterResponse(i)},this.ping=async i=>{await this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:h,resolve:d,reject:y}=Ei();this.events.once(_e("session_ping",o),({error:b})=>{b?y(b):d()}),await h()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async i=>{await this.isInitialized(),await this.isValidEmit(i);const{topic:n,event:o,chainId:h}=i;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:h}})},this.disconnect=async i=>{await this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:Le("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(n=>Am(n,i))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async i=>{if(i.pairingTopic)try{const n=this.client.core.pairing.pairings.get(i.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(h=>{var d,y;return((d=h.peerMetadata)==null?void 0:d.url)&&((y=h.peerMetadata)==null?void 0:y.url)===i.peer.metadata.url&&h.topic&&h.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(i,n)=>{const{self:o}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),this.client.session.delete(i,Le("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(_h).catch(h=>this.client.logger.warn(h))},this.deleteProposal=async(i,n)=>{await Promise.all([this.client.proposal.delete(i,Le("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(i)])},this.deletePendingSessionRequest=async(i,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,n),o?Promise.resolve():this.client.core.expirer.del(i)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==i),o&&(this.sessionRequestQueue.state=Tt.idle)},this.setExpiry=async(i,n)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:n}),this.client.core.expirer.set(i,n)},this.setProposal=async(i,n)=>{await this.client.proposal.set(i,n),this.client.core.expirer.set(i,n.expiry)},this.setPendingSessionRequest=async i=>{const n=er.wc_sessionRequest.req.ttl,{id:o,topic:h,params:d,verifyContext:y}=i;await this.client.pendingRequest.set(o,{id:o,topic:h,params:d,verifyContext:y}),n&&this.client.core.expirer.set(o,lt(n))},this.sendRequest=async i=>{const{topic:n,method:o,params:h,expiry:d,relayRpcId:y,clientRpcId:b,throwOnFailedPublish:x}=i,q=ar(o,h,b);if(Uh()&&zb.includes(o)){const G=Pi(JSON.stringify(q));this.client.core.verify.register({attestationId:G})}const $=await this.client.core.crypto.encode(n,q),D=er[o].req;return d&&(D.ttl=d),y&&(D.id=y),this.client.core.history.set(n,q),x?(D.internal=tr(ke({},D.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,$,D)):this.client.core.relayer.publish(n,$,D).catch(G=>this.client.logger.error(G)),q.id},this.sendResult=async i=>{const{id:n,topic:o,result:h,throwOnFailedPublish:d}=i,y=oo(n,h),b=await this.client.core.crypto.encode(o,y),x=await this.client.core.history.get(o,n),q=er[x.request.method].res;d?(q.internal=tr(ke({},q.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,b,q)):this.client.core.relayer.publish(o,b,q).catch($=>this.client.logger.error($)),await this.client.core.history.resolve(y)},this.sendError=async(i,n,o)=>{const h=ps(i,o),d=await this.client.core.crypto.encode(n,h),y=await this.client.core.history.get(n,i),b=er[y.request.method].res;this.client.core.relayer.publish(n,d,b),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const i=[],n=[];this.client.session.getAll().forEach(o=>{Ft(o.expiry)&&i.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Ft(o.expiry)&&n.push(o.id)}),await Promise.all([...i.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Tt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Tt.active;const i=this.requestQueue.queue.shift();if(i)try{this.processRequest(i),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=Tt.idle},this.processRequest=i=>{const{topic:n,payload:o}=i,h=o.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:o}=i,h=(await this.client.core.history.get(n,o.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=i=>{const{topic:n}=i,{message:o}=T("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(i,n)=>{const{params:o,id:h}=n;try{this.isValidConnect(ke({},n.params));const d=lt(z.FIVE_MINUTES),y=ke({id:h,pairingTopic:i,expiry:d},o);await this.setProposal(h,y);const b=Pi(JSON.stringify(n)),x=await this.getVerifyContext(b,y.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:y,verifyContext:x})}catch(d){await this.sendError(h,i,d),this.client.logger.error(d)}},this.onSessionProposeResponse=async(i,n)=>{const{id:o}=n;if(Vt(n)){const{result:h}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const d=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const y=d.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const b=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:b});const x=await this.client.core.crypto.generateSharedKey(y,b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:x});const q=await this.client.core.relayer.subscribe(x);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:q}),await this.client.core.pairing.activate({topic:i})}else Nt(n)&&(await this.client.proposal.delete(o,Le("USER_DISCONNECTED")),this.events.emit(_e("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidSessionSettleRequest(h);const{relay:d,controller:y,expiry:b,namespaces:x,requiredNamespaces:q,optionalNamespaces:$,sessionProperties:D,pairingTopic:G}=n.params,O=ke({topic:i,relay:d,expiry:b,namespaces:x,acknowledged:!0,pairingTopic:G,requiredNamespaces:q,optionalNamespaces:$,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},D&&{sessionProperties:D});await this.sendResult({id:n.id,topic:i,result:!0}),this.events.emit(_e("session_connect"),{session:O}),this.cleanupDuplicatePairings(O)}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.onSessionSettleResponse=async(i,n)=>{const{id:o}=n;Vt(n)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(_e("session_approve",o),{})):Nt(n)&&(await this.client.session.delete(i,Le("USER_DISCONNECTED")),this.events.emit(_e("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(i,n)=>{const{params:o,id:h}=n;try{const d=`${i}_session_update`,y=rs.get(d);if(y&&this.isRequestOutOfSync(y,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(ke({topic:i},o)),await this.client.session.update(i,{namespaces:o.namespaces}),await this.sendResult({id:h,topic:i,result:!0}),this.client.events.emit("session_update",{id:h,topic:i,params:o}),rs.set(d,h)}catch(d){await this.sendError(h,i,d),this.client.logger.error(d)}},this.isRequestOutOfSync=(i,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(i.toString().slice(0,-3)),this.onSessionUpdateResponse=(i,n)=>{const{id:o}=n;Vt(n)?this.events.emit(_e("session_update",o),{}):Nt(n)&&this.events.emit(_e("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(i,n)=>{const{id:o}=n;try{this.isValidExtend({topic:i}),await this.setExpiry(i,lt(ss)),await this.sendResult({id:o,topic:i,result:!0}),this.client.events.emit("session_extend",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(i,n)=>{const{id:o}=n;Vt(n)?this.events.emit(_e("session_extend",o),{}):Nt(n)&&this.events.emit(_e("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(i,n)=>{const{id:o}=n;try{this.isValidPing({topic:i}),await this.sendResult({id:o,topic:i,result:!0}),this.client.events.emit("session_ping",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionPingResponse=(i,n)=>{const{id:o}=n;setTimeout(()=>{Vt(n)?this.events.emit(_e("session_ping",o),{}):Nt(n)&&this.events.emit(_e("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(i,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:i,reason:n.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Ne.publish,async()=>{h(await this.deleteSession(i))})}),this.sendResult({id:o,topic:i,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:i})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidRequest(ke({topic:i},h));const d=Pi(JSON.stringify(ar("wc_sessionRequest",h,o))),y=this.client.session.get(i),b=await this.getVerifyContext(d,y.peer.metadata),x={id:o,topic:i,params:h,verifyContext:b};await this.setPendingSessionRequest(x),this.addSessionRequestToSessionRequestQueue(x),this.processSessionRequestQueue()}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.onSessionRequestResponse=(i,n)=>{const{id:o}=n;Vt(n)?this.events.emit(_e("session_request",o),{result:n.result}):Nt(n)&&this.events.emit(_e("session_request",o),{error:n.error})},this.onSessionEventRequest=async(i,n)=>{const{id:o,params:h}=n;try{const d=`${i}_session_event_${h.event.name}`,y=rs.get(d);if(y&&this.isRequestOutOfSync(y,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(ke({topic:i},h)),this.client.events.emit("session_event",{id:o,topic:i,params:h}),rs.set(d,o)}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.addSessionRequestToSessionRequestQueue=i=>{this.sessionRequestQueue.queue.push(i)},this.cleanupAfterResponse=i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Tt.idle,this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Tt.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Tt.active,this.client.events.emit("session_request",i)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=i=>{if(i.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===i.topic);n&&this.onSessionProposeRequest(i.topic,ar("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer},n.id))},this.isValidConnect=async i=>{if(!Ve(i)){const{message:b}=T("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(b)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:h,sessionProperties:d,relays:y}=i;if(Ht(n)||await this.isValidPairingTopic(n),!Tm(y)){const{message:b}=T("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(b)}!Ht(o)&&cs(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!Ht(h)&&cs(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),Ht(d)||this.validateSessionProps(d,"sessionProperties")},this.validateNamespaces=(i,n)=>{const o=Nm(i,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async i=>{if(!Ve(i))throw new Error(T("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:n,namespaces:o,relayProtocol:h,sessionProperties:d}=i;await this.isValidProposalId(n);const y=this.client.proposal.get(n),b=zn(o,"approve()");if(b)throw new Error(b.message);const x=Jc(y.requiredNamespaces,o,"approve()");if(x)throw new Error(x.message);if(!Ii(h,!0)){const{message:q}=T("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(q)}Ht(d)||this.validateSessionProps(d,"sessionProperties")},this.isValidReject=async i=>{if(!Ve(i)){const{message:h}=T("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(h)}const{id:n,reason:o}=i;if(await this.isValidProposalId(n),!qm(o)){const{message:h}=T("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidSessionSettleRequest=i=>{if(!Ve(i)){const{message:x}=T("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(x)}const{relay:n,controller:o,namespaces:h,expiry:d}=i;if(!$m(n)){const{message:x}=T("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(x)}const y=Dm(o,"onSessionSettleRequest()");if(y)throw new Error(y.message);const b=zn(h,"onSessionSettleRequest()");if(b)throw new Error(b.message);if(Ft(d)){const{message:x}=T("EXPIRED","onSessionSettleRequest()");throw new Error(x)}},this.isValidUpdate=async i=>{if(!Ve(i)){const{message:b}=T("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(b)}const{topic:n,namespaces:o}=i;await this.isValidSessionTopic(n);const h=this.client.session.get(n),d=zn(o,"update()");if(d)throw new Error(d.message);const y=Jc(h.requiredNamespaces,o,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async i=>{if(!Ve(i)){const{message:o}=T("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionTopic(n)},this.isValidRequest=async i=>{if(!Ve(i)){const{message:b}=T("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(b)}const{topic:n,request:o,chainId:h,expiry:d}=i;await this.isValidSessionTopic(n);const{namespaces:y}=this.client.session.get(n);if(!Yc(y,h)){const{message:b}=T("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(b)}if(!Lm(o)){const{message:b}=T("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(b)}if(!jm(y,h,o.method)){const{message:b}=T("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(b)}if(d&&!Mm(d,Bn)){const{message:b}=T("MISSING_OR_INVALID",`request() expiry: ${d}. Expiry must be a number (in seconds) between ${Bn.min} and ${Bn.max}`);throw new Error(b)}},this.isValidRespond=async i=>{if(!Ve(i)){const{message:h}=T("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(h)}const{topic:n,response:o}=i;if(await this.isValidSessionTopic(n),!zm(o)){const{message:h}=T("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidPing=async i=>{if(!Ve(i)){const{message:o}=T("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async i=>{if(!Ve(i)){const{message:y}=T("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(y)}const{topic:n,event:o,chainId:h}=i;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!Yc(d,h)){const{message:y}=T("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(y)}if(!Um(o)){const{message:y}=T("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}if(!km(d,h,o.name)){const{message:y}=T("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}},this.isValidDisconnect=async i=>{if(!Ve(i)){const{message:o}=T("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(i,n)=>{const o={verified:{verifyUrl:n.verifyUrl||hs,validation:"UNKNOWN",origin:n.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:i,verifyUrl:n.verifyUrl});h&&(o.verified.origin=h.origin,o.verified.isScam=h.isScam,o.verified.validation=h.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(i,n)=>{Object.values(i).forEach(o=>{if(!Ii(o,!1)){const{message:h}=T("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:r}=T("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ne.message,async r=>{const{topic:i,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(i,n);try{so(o)?(this.client.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):no(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.client.core.history.delete(i,o.id)):this.onRelayEventUnknownPayload({topic:i,payload:o})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(st.expired,async r=>{const{topic:i,id:n}=zh(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,T("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession(i,!0),this.client.events.emit("session_expire",{topic:i})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(sr.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!Ii(r,!1)){const{message:i}=T("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:i}=T("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Ft(this.client.core.pairing.pairings.get(r).expiry)){const{message:i}=T("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}async isValidSessionTopic(r){if(!Ii(r,!1)){const{message:i}=T("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(i)}if(!this.client.session.keys.includes(r)){const{message:i}=T("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(i)}if(Ft(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:i}=T("EXPIRED",`session topic: ${r}`);throw new Error(i)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(Ii(r,!1)){const{message:i}=T("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(i)}else{const{message:i}=T("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(i)}}async isValidProposalId(r){if(!Vm(r)){const{message:i}=T("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(i)}if(!this.client.proposal.keys.includes(r)){const{message:i}=T("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(i)}if(Ft(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:i}=T("EXPIRED",`proposal id: ${r}`);throw new Error(i)}}}class Kb extends fs{constructor(r,i){super(r,i,Db,uo),this.core=r,this.logger=i}}class Wb extends fs{constructor(r,i){super(r,i,Lb,uo),this.core=r,this.logger=i}}class Gb extends fs{constructor(r,i){super(r,i,Mb,uo,n=>n.id),this.core=r,this.logger=i}}let Qb=class cu extends rw{constructor(r){super(r),this.protocol=su,this.version=nu,this.name=Hn.name,this.events=new mt.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=r?.name||Hn.name,this.metadata=r?.metadata||Rm();const i=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:Y.pino(Y.getDefaultLoggerOptions({level:r?.logger||Hn.logger}));this.core=r?.core||new $b(r),this.logger=Y.generateChildLogger(i,this.name),this.session=new Wb(this.core,this.logger),this.proposal=new Kb(this.core,this.logger),this.pendingRequest=new Gb(this.core,this.logger),this.engine=new Bb(this)}static async init(r){const i=new cu(r);return await i.initialize(),i}get context(){return Y.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};var nr={exports:{}},Jb=nr.exports,Ih;function Yb(){return Ih||(Ih=1,function(p,r){var i=typeof self<"u"?self:Jb,n=function(){function h(){this.fetch=!1,this.DOMException=i.DOMException}return h.prototype=i,new h}();(function(h){(function(d){var y={searchParams:"URLSearchParams"in h,iterable:"Symbol"in h&&"iterator"in Symbol,blob:"FileReader"in h&&"Blob"in h&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in h,arrayBuffer:"ArrayBuffer"in h};function b(_){return _&&DataView.prototype.isPrototypeOf(_)}if(y.arrayBuffer)var x=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],q=ArrayBuffer.isView||function(_){return _&&x.indexOf(Object.prototype.toString.call(_))>-1};function $(_){if(typeof _!="string"&&(_=String(_)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(_))throw new TypeError("Invalid character in header field name");return _.toLowerCase()}function D(_){return typeof _!="string"&&(_=String(_)),_}function G(_){var R={next:function(){var F=_.shift();return{done:F===void 0,value:F}}};return y.iterable&&(R[Symbol.iterator]=function(){return R}),R}function O(_){this.map={},_ instanceof O?_.forEach(function(R,F){this.append(F,R)},this):Array.isArray(_)?_.forEach(function(R){this.append(R[0],R[1])},this):_&&Object.getOwnPropertyNames(_).forEach(function(R){this.append(R,_[R])},this)}O.prototype.append=function(_,R){_=$(_),R=D(R);var F=this.map[_];this.map[_]=F?F+", "+R:R},O.prototype.delete=function(_){delete this.map[$(_)]},O.prototype.get=function(_){return _=$(_),this.has(_)?this.map[_]:null},O.prototype.has=function(_){return this.map.hasOwnProperty($(_))},O.prototype.set=function(_,R){this.map[$(_)]=D(R)},O.prototype.forEach=function(_,R){for(var F in this.map)this.map.hasOwnProperty(F)&&_.call(R,this.map[F],F,this)},O.prototype.keys=function(){var _=[];return this.forEach(function(R,F){_.push(F)}),G(_)},O.prototype.values=function(){var _=[];return this.forEach(function(R){_.push(R)}),G(_)},O.prototype.entries=function(){var _=[];return this.forEach(function(R,F){_.push([F,R])}),G(_)},y.iterable&&(O.prototype[Symbol.iterator]=O.prototype.entries);function te(_){if(_.bodyUsed)return Promise.reject(new TypeError("Already read"));_.bodyUsed=!0}function se(_){return new Promise(function(R,F){_.onload=function(){R(_.result)},_.onerror=function(){F(_.error)}})}function ae(_){var R=new FileReader,F=se(R);return R.readAsArrayBuffer(_),F}function Pe(_){var R=new FileReader,F=se(R);return R.readAsText(_),F}function X(_){for(var R=new Uint8Array(_),F=new Array(R.length),le=0;le<R.length;le++)F[le]=String.fromCharCode(R[le]);return F.join("")}function J(_){if(_.slice)return _.slice(0);var R=new Uint8Array(_.byteLength);return R.set(new Uint8Array(_)),R.buffer}function ne(){return this.bodyUsed=!1,this._initBody=function(_){this._bodyInit=_,_?typeof _=="string"?this._bodyText=_:y.blob&&Blob.prototype.isPrototypeOf(_)?this._bodyBlob=_:y.formData&&FormData.prototype.isPrototypeOf(_)?this._bodyFormData=_:y.searchParams&&URLSearchParams.prototype.isPrototypeOf(_)?this._bodyText=_.toString():y.arrayBuffer&&y.blob&&b(_)?(this._bodyArrayBuffer=J(_.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):y.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(_)||q(_))?this._bodyArrayBuffer=J(_):this._bodyText=_=Object.prototype.toString.call(_):this._bodyText="",this.headers.get("content-type")||(typeof _=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(_)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob&&(this.blob=function(){var _=te(this);if(_)return _;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?te(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(ae)}),this.text=function(){var _=te(this);if(_)return _;if(this._bodyBlob)return Pe(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(X(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(pt)}),this.json=function(){return this.text().then(JSON.parse)},this}var Se=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function de(_){var R=_.toUpperCase();return Se.indexOf(R)>-1?R:_}function fe(_,R){R=R||{};var F=R.body;if(_ instanceof fe){if(_.bodyUsed)throw new TypeError("Already read");this.url=_.url,this.credentials=_.credentials,R.headers||(this.headers=new O(_.headers)),this.method=_.method,this.mode=_.mode,this.signal=_.signal,!F&&_._bodyInit!=null&&(F=_._bodyInit,_.bodyUsed=!0)}else this.url=String(_);if(this.credentials=R.credentials||this.credentials||"same-origin",(R.headers||!this.headers)&&(this.headers=new O(R.headers)),this.method=de(R.method||this.method||"GET"),this.mode=R.mode||this.mode||null,this.signal=R.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&F)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(F)}fe.prototype.clone=function(){return new fe(this,{body:this._bodyInit})};function pt(_){var R=new FormData;return _.trim().split("&").forEach(function(F){if(F){var le=F.split("="),ce=le.shift().replace(/\+/g," "),ie=le.join("=").replace(/\+/g," ");R.append(decodeURIComponent(ce),decodeURIComponent(ie))}}),R}function gs(_){var R=new O,F=_.replace(/\r?\n[\t ]+/g," ");return F.split(/\r?\n/).forEach(function(le){var ce=le.split(":"),ie=ce.shift().trim();if(ie){var wt=ce.join(":").trim();R.append(ie,wt)}}),R}ne.call(fe.prototype);function Qe(_,R){R||(R={}),this.type="default",this.status=R.status===void 0?200:R.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in R?R.statusText:"OK",this.headers=new O(R.headers),this.url=R.url||"",this._initBody(_)}ne.call(Qe.prototype),Qe.prototype.clone=function(){return new Qe(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new O(this.headers),url:this.url})},Qe.error=function(){var _=new Qe(null,{status:0,statusText:""});return _.type="error",_};var ys=[301,302,303,307,308];Qe.redirect=function(_,R){if(ys.indexOf(R)===-1)throw new RangeError("Invalid status code");return new Qe(null,{status:R,headers:{location:_}})},d.DOMException=h.DOMException;try{new d.DOMException}catch{d.DOMException=function(R,F){this.message=R,this.name=F;var le=Error(R);this.stack=le.stack},d.DOMException.prototype=Object.create(Error.prototype),d.DOMException.prototype.constructor=d.DOMException}function Ci(_,R){return new Promise(function(F,le){var ce=new fe(_,R);if(ce.signal&&ce.signal.aborted)return le(new d.DOMException("Aborted","AbortError"));var ie=new XMLHttpRequest;function wt(){ie.abort()}ie.onload=function(){var Oe={status:ie.status,statusText:ie.statusText,headers:gs(ie.getAllResponseHeaders()||"")};Oe.url="responseURL"in ie?ie.responseURL:Oe.headers.get("X-Request-URL");var Oi="response"in ie?ie.response:ie.responseText;F(new Qe(Oi,Oe))},ie.onerror=function(){le(new TypeError("Network request failed"))},ie.ontimeout=function(){le(new TypeError("Network request failed"))},ie.onabort=function(){le(new d.DOMException("Aborted","AbortError"))},ie.open(ce.method,ce.url,!0),ce.credentials==="include"?ie.withCredentials=!0:ce.credentials==="omit"&&(ie.withCredentials=!1),"responseType"in ie&&y.blob&&(ie.responseType="blob"),ce.headers.forEach(function(Oe,Oi){ie.setRequestHeader(Oi,Oe)}),ce.signal&&(ce.signal.addEventListener("abort",wt),ie.onreadystatechange=function(){ie.readyState===4&&ce.signal.removeEventListener("abort",wt)}),ie.send(typeof ce._bodyInit>"u"?null:ce._bodyInit)})}return Ci.polyfill=!0,h.fetch||(h.fetch=Ci,h.Headers=O,h.Request=fe,h.Response=Qe),d.Headers=O,d.Request=fe,d.Response=Qe,d.fetch=Ci,Object.defineProperty(d,"__esModule",{value:!0}),d})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var o=n;r=o.fetch,r.default=o.fetch,r.fetch=o.fetch,r.Headers=o.Headers,r.Request=o.Request,r.Response=o.Response,p.exports=r}(nr,nr.exports)),nr.exports}var Zb=Yb();const Ph=Hm(Zb),Xb={Accept:"application/json","Content-Type":"application/json"},e0="POST",Sh={headers:Xb,method:e0},xh=10;class si{constructor(r,i=!1){if(this.url=r,this.disableProviderPing=i,this.events=new mt.EventEmitter,this.isAvailable=!1,this.registering=!1,!Zc(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);this.url=r,this.disableProviderPing=i}get connected(){return this.isAvailable}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(r,i){this.isAvailable||await this.register();try{const n=us(r),h=await(await Ph(this.url,Object.assign(Object.assign({},Sh),{body:n}))).json();this.onPayload({data:h})}catch(n){this.onError(r.id,n)}}async register(r=this.url){if(!Zc(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=r,this.registering=!0;try{if(!this.disableProviderPing){const i=us({id:1,jsonrpc:"2.0",method:"test",params:[]});await Ph(r,Object.assign(Object.assign({},Sh),{body:i}))}this.onOpen()}catch(i){const n=this.parseError(i);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?ro(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),h=ps(r,o);this.events.emit("payload",h)}parseError(r,i=this.url){return jh(r,i,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>xh&&this.events.setMaxListeners(xh)}}const Rh="error",t0="wss://relay.walletconnect.com",i0="wc",r0="universal_provider",Ch=`${i0}@2:${r0}:`,s0="https://rpc.walletconnect.com/v1/",Wt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var ir=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ri<"u"?ri:typeof self<"u"?self:{},eo={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(p,r){(function(){var i,n="4.17.21",o=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",y="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",x=500,q="__lodash_placeholder__",$=1,D=2,G=4,O=1,te=2,se=1,ae=2,Pe=4,X=8,J=16,ne=32,Se=64,de=128,fe=256,pt=512,gs=30,Qe="...",ys=800,Ci=16,_=1,R=2,F=3,le=1/0,ce=9007199254740991,ie=17976931348623157e292,wt=NaN,Oe=4294967295,Oi=Oe-1,lu=Oe>>>1,pu=[["ary",de],["bind",se],["bindKey",ae],["curry",X],["curryRight",J],["flip",pt],["partial",ne],["partialRight",Se],["rearg",fe]],oi="[object Arguments]",lr="[object Array]",du="[object AsyncFunction]",Ai="[object Boolean]",Ti="[object Date]",fu="[object DOMException]",pr="[object Error]",dr="[object Function]",fo="[object GeneratorFunction]",nt="[object Map]",Ni="[object Number]",gu="[object Null]",_t="[object Object]",go="[object Promise]",yu="[object Proxy]",qi="[object RegExp]",ot="[object Set]",$i="[object String]",fr="[object Symbol]",vu="[object Undefined]",Di="[object WeakMap]",mu="[object WeakSet]",Li="[object ArrayBuffer]",ai="[object DataView]",vs="[object Float32Array]",ms="[object Float64Array]",ws="[object Int8Array]",_s="[object Int16Array]",bs="[object Int32Array]",Es="[object Uint8Array]",Is="[object Uint8ClampedArray]",Ps="[object Uint16Array]",Ss="[object Uint32Array]",wu=/\b__p \+= '';/g,_u=/\b(__p \+=) '' \+/g,bu=/(__e\(.*?\)|\b__t\)) \+\n'';/g,yo=/&(?:amp|lt|gt|quot|#39);/g,vo=/[&<>"']/g,Eu=RegExp(yo.source),Iu=RegExp(vo.source),Pu=/<%-([\s\S]+?)%>/g,Su=/<%([\s\S]+?)%>/g,mo=/<%=([\s\S]+?)%>/g,xu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ru=/^\w*$/,Cu=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xs=/[\\^$.*+?()[\]{}|]/g,Ou=RegExp(xs.source),Rs=/^\s+/,Au=/\s/,Tu=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Nu=/\{\n\/\* \[wrapped with (.+)\] \*/,qu=/,? & /,$u=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Du=/[()=,{}\[\]\/\s]/,Lu=/\\(\\)?/g,ju=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,wo=/\w*$/,Mu=/^[-+]0x[0-9a-f]+$/i,zu=/^0b[01]+$/i,Uu=/^\[object .+?Constructor\]$/,ku=/^0o[0-7]+$/i,Vu=/^(?:0|[1-9]\d*)$/,Fu=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,gr=/($^)/,Hu=/['\n\r\u2028\u2029\\]/g,yr="\\ud800-\\udfff",Bu="\\u0300-\\u036f",Ku="\\ufe20-\\ufe2f",Wu="\\u20d0-\\u20ff",_o=Bu+Ku+Wu,bo="\\u2700-\\u27bf",Eo="a-z\\xdf-\\xf6\\xf8-\\xff",Gu="\\xac\\xb1\\xd7\\xf7",Qu="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ju="\\u2000-\\u206f",Yu=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Io="A-Z\\xc0-\\xd6\\xd8-\\xde",Po="\\ufe0e\\ufe0f",So=Gu+Qu+Ju+Yu,Cs="['â€™]",Zu="["+yr+"]",xo="["+So+"]",vr="["+_o+"]",Ro="\\d+",Xu="["+bo+"]",Co="["+Eo+"]",Oo="[^"+yr+So+Ro+bo+Eo+Io+"]",Os="\\ud83c[\\udffb-\\udfff]",el="(?:"+vr+"|"+Os+")",Ao="[^"+yr+"]",As="(?:\\ud83c[\\udde6-\\uddff]){2}",Ts="[\\ud800-\\udbff][\\udc00-\\udfff]",ci="["+Io+"]",To="\\u200d",No="(?:"+Co+"|"+Oo+")",tl="(?:"+ci+"|"+Oo+")",qo="(?:"+Cs+"(?:d|ll|m|re|s|t|ve))?",$o="(?:"+Cs+"(?:D|LL|M|RE|S|T|VE))?",Do=el+"?",Lo="["+Po+"]?",il="(?:"+To+"(?:"+[Ao,As,Ts].join("|")+")"+Lo+Do+")*",rl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",sl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",jo=Lo+Do+il,nl="(?:"+[Xu,As,Ts].join("|")+")"+jo,ol="(?:"+[Ao+vr+"?",vr,As,Ts,Zu].join("|")+")",al=RegExp(Cs,"g"),cl=RegExp(vr,"g"),Ns=RegExp(Os+"(?="+Os+")|"+ol+jo,"g"),hl=RegExp([ci+"?"+Co+"+"+qo+"(?="+[xo,ci,"$"].join("|")+")",tl+"+"+$o+"(?="+[xo,ci+No,"$"].join("|")+")",ci+"?"+No+"+"+qo,ci+"+"+$o,sl,rl,Ro,nl].join("|"),"g"),ul=RegExp("["+To+yr+_o+Po+"]"),ll=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,pl=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],dl=-1,ue={};ue[vs]=ue[ms]=ue[ws]=ue[_s]=ue[bs]=ue[Es]=ue[Is]=ue[Ps]=ue[Ss]=!0,ue[oi]=ue[lr]=ue[Li]=ue[Ai]=ue[ai]=ue[Ti]=ue[pr]=ue[dr]=ue[nt]=ue[Ni]=ue[_t]=ue[qi]=ue[ot]=ue[$i]=ue[Di]=!1;var he={};he[oi]=he[lr]=he[Li]=he[ai]=he[Ai]=he[Ti]=he[vs]=he[ms]=he[ws]=he[_s]=he[bs]=he[nt]=he[Ni]=he[_t]=he[qi]=he[ot]=he[$i]=he[fr]=he[Es]=he[Is]=he[Ps]=he[Ss]=!0,he[pr]=he[dr]=he[Di]=!1;var fl={Ã€:"A",Ã:"A",Ã‚:"A",Ãƒ:"A",Ã„:"A",Ã…:"A",Ã :"a",Ã¡:"a",Ã¢:"a",Ã£:"a",Ã¤:"a",Ã¥:"a",Ã‡:"C",Ã§:"c",Ã:"D",Ã°:"d",Ãˆ:"E",Ã‰:"E",ÃŠ:"E",Ã‹:"E",Ã¨:"e",Ã©:"e",Ãª:"e",Ã«:"e",ÃŒ:"I",Ã:"I",ÃŽ:"I",Ã:"I",Ã¬:"i",Ã­:"i",Ã®:"i",Ã¯:"i",Ã‘:"N",Ã±:"n",Ã’:"O",Ã“:"O",Ã”:"O",Ã•:"O",Ã–:"O",Ã˜:"O",Ã²:"o",Ã³:"o",Ã´:"o",Ãµ:"o",Ã¶:"o",Ã¸:"o",Ã™:"U",Ãš:"U",Ã›:"U",Ãœ:"U",Ã¹:"u",Ãº:"u",Ã»:"u",Ã¼:"u",Ã:"Y",Ã½:"y",Ã¿:"y",Ã†:"Ae",Ã¦:"ae",Ãž:"Th",Ã¾:"th",ÃŸ:"ss",Ä€:"A",Ä‚:"A",Ä„:"A",Ä:"a",Äƒ:"a",Ä…:"a",Ä†:"C",Äˆ:"C",ÄŠ:"C",ÄŒ:"C",Ä‡:"c",Ä‰:"c",Ä‹:"c",Ä:"c",ÄŽ:"D",Ä:"D",Ä:"d",Ä‘:"d",Ä’:"E",Ä”:"E",Ä–:"E",Ä˜:"E",Äš:"E",Ä“:"e",Ä•:"e",Ä—:"e",Ä™:"e",Ä›:"e",Äœ:"G",Äž:"G",Ä :"G",Ä¢:"G",Ä:"g",ÄŸ:"g",Ä¡:"g",Ä£:"g",Ä¤:"H",Ä¦:"H",Ä¥:"h",Ä§:"h",Ä¨:"I",Äª:"I",Ä¬:"I",Ä®:"I",Ä°:"I",Ä©:"i",Ä«:"i",Ä­:"i",Ä¯:"i",Ä±:"i",Ä´:"J",Äµ:"j",Ä¶:"K",Ä·:"k",Ä¸:"k",Ä¹:"L",Ä»:"L",Ä½:"L",Ä¿:"L",Å:"L",Äº:"l",Ä¼:"l",Ä¾:"l",Å€:"l",Å‚:"l",Åƒ:"N",Å…:"N",Å‡:"N",ÅŠ:"N",Å„:"n",Å†:"n",Åˆ:"n",Å‹:"n",ÅŒ:"O",ÅŽ:"O",Å:"O",Å:"o",Å:"o",Å‘:"o",Å”:"R",Å–:"R",Å˜:"R",Å•:"r",Å—:"r",Å™:"r",Åš:"S",Åœ:"S",Åž:"S",Å :"S",Å›:"s",Å:"s",ÅŸ:"s",Å¡:"s",Å¢:"T",Å¤:"T",Å¦:"T",Å£:"t",Å¥:"t",Å§:"t",Å¨:"U",Åª:"U",Å¬:"U",Å®:"U",Å°:"U",Å²:"U",Å©:"u",Å«:"u",Å­:"u",Å¯:"u",Å±:"u",Å³:"u",Å´:"W",Åµ:"w",Å¶:"Y",Å·:"y",Å¸:"Y",Å¹:"Z",Å»:"Z",Å½:"Z",Åº:"z",Å¼:"z",Å¾:"z",Ä²:"IJ",Ä³:"ij",Å’:"Oe",Å“:"oe",Å‰:"'n",Å¿:"s"},gl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},yl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},vl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ml=parseFloat,wl=parseInt,Mo=typeof ir=="object"&&ir&&ir.Object===Object&&ir,_l=typeof self=="object"&&self&&self.Object===Object&&self,xe=Mo||_l||Function("return this")(),qs=r&&!r.nodeType&&r,Gt=qs&&!0&&p&&!p.nodeType&&p,zo=Gt&&Gt.exports===qs,$s=zo&&Mo.process,Je=function(){try{var v=Gt&&Gt.require&&Gt.require("util").types;return v||$s&&$s.binding&&$s.binding("util")}catch{}}(),Uo=Je&&Je.isArrayBuffer,ko=Je&&Je.isDate,Vo=Je&&Je.isMap,Fo=Je&&Je.isRegExp,Ho=Je&&Je.isSet,Bo=Je&&Je.isTypedArray;function Fe(v,E,w){switch(w.length){case 0:return v.call(E);case 1:return v.call(E,w[0]);case 2:return v.call(E,w[0],w[1]);case 3:return v.call(E,w[0],w[1],w[2])}return v.apply(E,w)}function bl(v,E,w,A){for(var U=-1,Z=v==null?0:v.length;++U<Z;){var be=v[U];E(A,be,w(be),v)}return A}function Ye(v,E){for(var w=-1,A=v==null?0:v.length;++w<A&&E(v[w],w,v)!==!1;);return v}function El(v,E){for(var w=v==null?0:v.length;w--&&E(v[w],w,v)!==!1;);return v}function Ko(v,E){for(var w=-1,A=v==null?0:v.length;++w<A;)if(!E(v[w],w,v))return!1;return!0}function qt(v,E){for(var w=-1,A=v==null?0:v.length,U=0,Z=[];++w<A;){var be=v[w];E(be,w,v)&&(Z[U++]=be)}return Z}function mr(v,E){var w=v==null?0:v.length;return!!w&&hi(v,E,0)>-1}function Ds(v,E,w){for(var A=-1,U=v==null?0:v.length;++A<U;)if(w(E,v[A]))return!0;return!1}function pe(v,E){for(var w=-1,A=v==null?0:v.length,U=Array(A);++w<A;)U[w]=E(v[w],w,v);return U}function $t(v,E){for(var w=-1,A=E.length,U=v.length;++w<A;)v[U+w]=E[w];return v}function Ls(v,E,w,A){var U=-1,Z=v==null?0:v.length;for(A&&Z&&(w=v[++U]);++U<Z;)w=E(w,v[U],U,v);return w}function Il(v,E,w,A){var U=v==null?0:v.length;for(A&&U&&(w=v[--U]);U--;)w=E(w,v[U],U,v);return w}function js(v,E){for(var w=-1,A=v==null?0:v.length;++w<A;)if(E(v[w],w,v))return!0;return!1}var Pl=Ms("length");function Sl(v){return v.split("")}function xl(v){return v.match($u)||[]}function Wo(v,E,w){var A;return w(v,function(U,Z,be){if(E(U,Z,be))return A=Z,!1}),A}function wr(v,E,w,A){for(var U=v.length,Z=w+(A?1:-1);A?Z--:++Z<U;)if(E(v[Z],Z,v))return Z;return-1}function hi(v,E,w){return E===E?Ml(v,E,w):wr(v,Go,w)}function Rl(v,E,w,A){for(var U=w-1,Z=v.length;++U<Z;)if(A(v[U],E))return U;return-1}function Go(v){return v!==v}function Qo(v,E){var w=v==null?0:v.length;return w?Us(v,E)/w:wt}function Ms(v){return function(E){return E==null?i:E[v]}}function zs(v){return function(E){return v==null?i:v[E]}}function Jo(v,E,w,A,U){return U(v,function(Z,be,oe){w=A?(A=!1,Z):E(w,Z,be,oe)}),w}function Cl(v,E){var w=v.length;for(v.sort(E);w--;)v[w]=v[w].value;return v}function Us(v,E){for(var w,A=-1,U=v.length;++A<U;){var Z=E(v[A]);Z!==i&&(w=w===i?Z:w+Z)}return w}function ks(v,E){for(var w=-1,A=Array(v);++w<v;)A[w]=E(w);return A}function Ol(v,E){return pe(E,function(w){return[w,v[w]]})}function Yo(v){return v&&v.slice(0,ta(v)+1).replace(Rs,"")}function He(v){return function(E){return v(E)}}function Vs(v,E){return pe(E,function(w){return v[w]})}function ji(v,E){return v.has(E)}function Zo(v,E){for(var w=-1,A=v.length;++w<A&&hi(E,v[w],0)>-1;);return w}function Xo(v,E){for(var w=v.length;w--&&hi(E,v[w],0)>-1;);return w}function Al(v,E){for(var w=v.length,A=0;w--;)v[w]===E&&++A;return A}var Tl=zs(fl),Nl=zs(gl);function ql(v){return"\\"+vl[v]}function $l(v,E){return v==null?i:v[E]}function ui(v){return ul.test(v)}function Dl(v){return ll.test(v)}function Ll(v){for(var E,w=[];!(E=v.next()).done;)w.push(E.value);return w}function Fs(v){var E=-1,w=Array(v.size);return v.forEach(function(A,U){w[++E]=[U,A]}),w}function ea(v,E){return function(w){return v(E(w))}}function Dt(v,E){for(var w=-1,A=v.length,U=0,Z=[];++w<A;){var be=v[w];(be===E||be===q)&&(v[w]=q,Z[U++]=w)}return Z}function _r(v){var E=-1,w=Array(v.size);return v.forEach(function(A){w[++E]=A}),w}function jl(v){var E=-1,w=Array(v.size);return v.forEach(function(A){w[++E]=[A,A]}),w}function Ml(v,E,w){for(var A=w-1,U=v.length;++A<U;)if(v[A]===E)return A;return-1}function zl(v,E,w){for(var A=w+1;A--;)if(v[A]===E)return A;return A}function li(v){return ui(v)?kl(v):Pl(v)}function at(v){return ui(v)?Vl(v):Sl(v)}function ta(v){for(var E=v.length;E--&&Au.test(v.charAt(E)););return E}var Ul=zs(yl);function kl(v){for(var E=Ns.lastIndex=0;Ns.test(v);)++E;return E}function Vl(v){return v.match(Ns)||[]}function Fl(v){return v.match(hl)||[]}var Hl=function v(E){E=E==null?xe:pi.defaults(xe.Object(),E,pi.pick(xe,pl));var w=E.Array,A=E.Date,U=E.Error,Z=E.Function,be=E.Math,oe=E.Object,Hs=E.RegExp,Bl=E.String,Ze=E.TypeError,br=w.prototype,Kl=Z.prototype,di=oe.prototype,Er=E["__core-js_shared__"],Ir=Kl.toString,re=di.hasOwnProperty,Wl=0,ia=function(){var e=/[^.]+$/.exec(Er&&Er.keys&&Er.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Pr=di.toString,Gl=Ir.call(oe),Ql=xe._,Jl=Hs("^"+Ir.call(re).replace(xs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sr=zo?E.Buffer:i,Lt=E.Symbol,xr=E.Uint8Array,ra=Sr?Sr.allocUnsafe:i,Rr=ea(oe.getPrototypeOf,oe),sa=oe.create,na=di.propertyIsEnumerable,Cr=br.splice,oa=Lt?Lt.isConcatSpreadable:i,Mi=Lt?Lt.iterator:i,Qt=Lt?Lt.toStringTag:i,Or=function(){try{var e=ei(oe,"defineProperty");return e({},"",{}),e}catch{}}(),Yl=E.clearTimeout!==xe.clearTimeout&&E.clearTimeout,Zl=A&&A.now!==xe.Date.now&&A.now,Xl=E.setTimeout!==xe.setTimeout&&E.setTimeout,Ar=be.ceil,Tr=be.floor,Bs=oe.getOwnPropertySymbols,ep=Sr?Sr.isBuffer:i,aa=E.isFinite,tp=br.join,ip=ea(oe.keys,oe),Ee=be.max,Ae=be.min,rp=A.now,sp=E.parseInt,ca=be.random,np=br.reverse,Ks=ei(E,"DataView"),zi=ei(E,"Map"),Ws=ei(E,"Promise"),fi=ei(E,"Set"),Ui=ei(E,"WeakMap"),ki=ei(oe,"create"),Nr=Ui&&new Ui,gi={},op=ti(Ks),ap=ti(zi),cp=ti(Ws),hp=ti(fi),up=ti(Ui),qr=Lt?Lt.prototype:i,Vi=qr?qr.valueOf:i,ha=qr?qr.toString:i;function u(e){if(ye(e)&&!k(e)&&!(e instanceof W)){if(e instanceof Xe)return e;if(re.call(e,"__wrapped__"))return uc(e)}return new Xe(e)}var yi=function(){function e(){}return function(t){if(!ge(t))return{};if(sa)return sa(t);e.prototype=t;var s=new e;return e.prototype=i,s}}();function $r(){}function Xe(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}u.templateSettings={escape:Pu,evaluate:Su,interpolate:mo,variable:"",imports:{_:u}},u.prototype=$r.prototype,u.prototype.constructor=u,Xe.prototype=yi($r.prototype),Xe.prototype.constructor=Xe;function W(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Oe,this.__views__=[]}function lp(){var e=new W(this.__wrapped__);return e.__actions__=je(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=je(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=je(this.__views__),e}function pp(){if(this.__filtered__){var e=new W(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function dp(){var e=this.__wrapped__.value(),t=this.__dir__,s=k(e),a=t<0,c=s?e.length:0,l=Sd(0,c,this.__views__),f=l.start,g=l.end,m=g-f,I=a?g:f-1,P=this.__iteratees__,S=P.length,C=0,N=Ae(m,this.__takeCount__);if(!s||!a&&c==m&&N==m)return qa(e,this.__actions__);var j=[];e:for(;m--&&C<N;){I+=t;for(var H=-1,M=e[I];++H<S;){var K=P[H],Q=K.iteratee,We=K.type,De=Q(M);if(We==R)M=De;else if(!De){if(We==_)continue e;break e}}j[C++]=M}return j}W.prototype=yi($r.prototype),W.prototype.constructor=W;function Jt(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function fp(){this.__data__=ki?ki(null):{},this.size=0}function gp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function yp(e){var t=this.__data__;if(ki){var s=t[e];return s===b?i:s}return re.call(t,e)?t[e]:i}function vp(e){var t=this.__data__;return ki?t[e]!==i:re.call(t,e)}function mp(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=ki&&t===i?b:t,this}Jt.prototype.clear=fp,Jt.prototype.delete=gp,Jt.prototype.get=yp,Jt.prototype.has=vp,Jt.prototype.set=mp;function bt(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function wp(){this.__data__=[],this.size=0}function _p(e){var t=this.__data__,s=Dr(t,e);if(s<0)return!1;var a=t.length-1;return s==a?t.pop():Cr.call(t,s,1),--this.size,!0}function bp(e){var t=this.__data__,s=Dr(t,e);return s<0?i:t[s][1]}function Ep(e){return Dr(this.__data__,e)>-1}function Ip(e,t){var s=this.__data__,a=Dr(s,e);return a<0?(++this.size,s.push([e,t])):s[a][1]=t,this}bt.prototype.clear=wp,bt.prototype.delete=_p,bt.prototype.get=bp,bt.prototype.has=Ep,bt.prototype.set=Ip;function Et(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Pp(){this.size=0,this.__data__={hash:new Jt,map:new(zi||bt),string:new Jt}}function Sp(e){var t=Wr(this,e).delete(e);return this.size-=t?1:0,t}function xp(e){return Wr(this,e).get(e)}function Rp(e){return Wr(this,e).has(e)}function Cp(e,t){var s=Wr(this,e),a=s.size;return s.set(e,t),this.size+=s.size==a?0:1,this}Et.prototype.clear=Pp,Et.prototype.delete=Sp,Et.prototype.get=xp,Et.prototype.has=Rp,Et.prototype.set=Cp;function Yt(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new Et;++t<s;)this.add(e[t])}function Op(e){return this.__data__.set(e,b),this}function Ap(e){return this.__data__.has(e)}Yt.prototype.add=Yt.prototype.push=Op,Yt.prototype.has=Ap;function ct(e){var t=this.__data__=new bt(e);this.size=t.size}function Tp(){this.__data__=new bt,this.size=0}function Np(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function qp(e){return this.__data__.get(e)}function $p(e){return this.__data__.has(e)}function Dp(e,t){var s=this.__data__;if(s instanceof bt){var a=s.__data__;if(!zi||a.length<o-1)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new Et(a)}return s.set(e,t),this.size=s.size,this}ct.prototype.clear=Tp,ct.prototype.delete=Np,ct.prototype.get=qp,ct.prototype.has=$p,ct.prototype.set=Dp;function ua(e,t){var s=k(e),a=!s&&ii(e),c=!s&&!a&&kt(e),l=!s&&!a&&!c&&_i(e),f=s||a||c||l,g=f?ks(e.length,Bl):[],m=g.length;for(var I in e)(t||re.call(e,I))&&!(f&&(I=="length"||c&&(I=="offset"||I=="parent")||l&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||xt(I,m)))&&g.push(I);return g}function la(e){var t=e.length;return t?e[nn(0,t-1)]:i}function Lp(e,t){return Gr(je(e),Zt(t,0,e.length))}function jp(e){return Gr(je(e))}function Gs(e,t,s){(s!==i&&!ht(e[t],s)||s===i&&!(t in e))&&It(e,t,s)}function Fi(e,t,s){var a=e[t];(!(re.call(e,t)&&ht(a,s))||s===i&&!(t in e))&&It(e,t,s)}function Dr(e,t){for(var s=e.length;s--;)if(ht(e[s][0],t))return s;return-1}function Mp(e,t,s,a){return jt(e,function(c,l,f){t(a,c,s(c),f)}),a}function pa(e,t){return e&&ft(t,Ie(t),e)}function zp(e,t){return e&&ft(t,ze(t),e)}function It(e,t,s){t=="__proto__"&&Or?Or(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function Qs(e,t){for(var s=-1,a=t.length,c=w(a),l=e==null;++s<a;)c[s]=l?i:An(e,t[s]);return c}function Zt(e,t,s){return e===e&&(s!==i&&(e=e<=s?e:s),t!==i&&(e=e>=t?e:t)),e}function et(e,t,s,a,c,l){var f,g=t&$,m=t&D,I=t&G;if(s&&(f=c?s(e,a,c,l):s(e)),f!==i)return f;if(!ge(e))return e;var P=k(e);if(P){if(f=Rd(e),!g)return je(e,f)}else{var S=Te(e),C=S==dr||S==fo;if(kt(e))return La(e,g);if(S==_t||S==oi||C&&!c){if(f=m||C?{}:tc(e),!g)return m?yd(e,zp(f,e)):gd(e,pa(f,e))}else{if(!he[S])return c?e:{};f=Cd(e,S,g)}}l||(l=new ct);var N=l.get(e);if(N)return N;l.set(e,f),Ac(e)?e.forEach(function(M){f.add(et(M,t,s,M,e,l))}):Cc(e)&&e.forEach(function(M,K){f.set(K,et(M,t,s,K,e,l))});var j=I?m?yn:gn:m?ze:Ie,H=P?i:j(e);return Ye(H||e,function(M,K){H&&(K=M,M=e[K]),Fi(f,K,et(M,t,s,K,e,l))}),f}function Up(e){var t=Ie(e);return function(s){return da(s,e,t)}}function da(e,t,s){var a=s.length;if(e==null)return!a;for(e=oe(e);a--;){var c=s[a],l=t[c],f=e[c];if(f===i&&!(c in e)||!l(f))return!1}return!0}function fa(e,t,s){if(typeof e!="function")throw new Ze(d);return Ji(function(){e.apply(i,s)},t)}function Hi(e,t,s,a){var c=-1,l=mr,f=!0,g=e.length,m=[],I=t.length;if(!g)return m;s&&(t=pe(t,He(s))),a?(l=Ds,f=!1):t.length>=o&&(l=ji,f=!1,t=new Yt(t));e:for(;++c<g;){var P=e[c],S=s==null?P:s(P);if(P=a||P!==0?P:0,f&&S===S){for(var C=I;C--;)if(t[C]===S)continue e;m.push(P)}else l(t,S,a)||m.push(P)}return m}var jt=ka(dt),ga=ka(Ys,!0);function kp(e,t){var s=!0;return jt(e,function(a,c,l){return s=!!t(a,c,l),s}),s}function Lr(e,t,s){for(var a=-1,c=e.length;++a<c;){var l=e[a],f=t(l);if(f!=null&&(g===i?f===f&&!Ke(f):s(f,g)))var g=f,m=l}return m}function Vp(e,t,s,a){var c=e.length;for(s=V(s),s<0&&(s=-s>c?0:c+s),a=a===i||a>c?c:V(a),a<0&&(a+=c),a=s>a?0:Nc(a);s<a;)e[s++]=t;return e}function ya(e,t){var s=[];return jt(e,function(a,c,l){t(a,c,l)&&s.push(a)}),s}function Re(e,t,s,a,c){var l=-1,f=e.length;for(s||(s=Ad),c||(c=[]);++l<f;){var g=e[l];t>0&&s(g)?t>1?Re(g,t-1,s,a,c):$t(c,g):a||(c[c.length]=g)}return c}var Js=Va(),va=Va(!0);function dt(e,t){return e&&Js(e,t,Ie)}function Ys(e,t){return e&&va(e,t,Ie)}function jr(e,t){return qt(t,function(s){return Rt(e[s])})}function Xt(e,t){t=zt(t,e);for(var s=0,a=t.length;e!=null&&s<a;)e=e[gt(t[s++])];return s&&s==a?e:i}function ma(e,t,s){var a=t(e);return k(e)?a:$t(a,s(e))}function qe(e){return e==null?e===i?vu:gu:Qt&&Qt in oe(e)?Pd(e):jd(e)}function Zs(e,t){return e>t}function Fp(e,t){return e!=null&&re.call(e,t)}function Hp(e,t){return e!=null&&t in oe(e)}function Bp(e,t,s){return e>=Ae(t,s)&&e<Ee(t,s)}function Xs(e,t,s){for(var a=s?Ds:mr,c=e[0].length,l=e.length,f=l,g=w(l),m=1/0,I=[];f--;){var P=e[f];f&&t&&(P=pe(P,He(t))),m=Ae(P.length,m),g[f]=!s&&(t||c>=120&&P.length>=120)?new Yt(f&&P):i}P=e[0];var S=-1,C=g[0];e:for(;++S<c&&I.length<m;){var N=P[S],j=t?t(N):N;if(N=s||N!==0?N:0,!(C?ji(C,j):a(I,j,s))){for(f=l;--f;){var H=g[f];if(!(H?ji(H,j):a(e[f],j,s)))continue e}C&&C.push(j),I.push(N)}}return I}function Kp(e,t,s,a){return dt(e,function(c,l,f){t(a,s(c),l,f)}),a}function Bi(e,t,s){t=zt(t,e),e=nc(e,t);var a=e==null?e:e[gt(it(t))];return a==null?i:Fe(a,e,s)}function wa(e){return ye(e)&&qe(e)==oi}function Wp(e){return ye(e)&&qe(e)==Li}function Gp(e){return ye(e)&&qe(e)==Ti}function Ki(e,t,s,a,c){return e===t?!0:e==null||t==null||!ye(e)&&!ye(t)?e!==e&&t!==t:Qp(e,t,s,a,Ki,c)}function Qp(e,t,s,a,c,l){var f=k(e),g=k(t),m=f?lr:Te(e),I=g?lr:Te(t);m=m==oi?_t:m,I=I==oi?_t:I;var P=m==_t,S=I==_t,C=m==I;if(C&&kt(e)){if(!kt(t))return!1;f=!0,P=!1}if(C&&!P)return l||(l=new ct),f||_i(e)?Za(e,t,s,a,c,l):Ed(e,t,m,s,a,c,l);if(!(s&O)){var N=P&&re.call(e,"__wrapped__"),j=S&&re.call(t,"__wrapped__");if(N||j){var H=N?e.value():e,M=j?t.value():t;return l||(l=new ct),c(H,M,s,a,l)}}return C?(l||(l=new ct),Id(e,t,s,a,c,l)):!1}function Jp(e){return ye(e)&&Te(e)==nt}function en(e,t,s,a){var c=s.length,l=c,f=!a;if(e==null)return!l;for(e=oe(e);c--;){var g=s[c];if(f&&g[2]?g[1]!==e[g[0]]:!(g[0]in e))return!1}for(;++c<l;){g=s[c];var m=g[0],I=e[m],P=g[1];if(f&&g[2]){if(I===i&&!(m in e))return!1}else{var S=new ct;if(a)var C=a(I,P,m,e,t,S);if(!(C===i?Ki(P,I,O|te,a,S):C))return!1}}return!0}function _a(e){if(!ge(e)||Nd(e))return!1;var t=Rt(e)?Jl:Uu;return t.test(ti(e))}function Yp(e){return ye(e)&&qe(e)==qi}function Zp(e){return ye(e)&&Te(e)==ot}function Xp(e){return ye(e)&&es(e.length)&&!!ue[qe(e)]}function ba(e){return typeof e=="function"?e:e==null?Ue:typeof e=="object"?k(e)?Pa(e[0],e[1]):Ia(e):Fc(e)}function tn(e){if(!Qi(e))return ip(e);var t=[];for(var s in oe(e))re.call(e,s)&&s!="constructor"&&t.push(s);return t}function ed(e){if(!ge(e))return Ld(e);var t=Qi(e),s=[];for(var a in e)a=="constructor"&&(t||!re.call(e,a))||s.push(a);return s}function rn(e,t){return e<t}function Ea(e,t){var s=-1,a=Me(e)?w(e.length):[];return jt(e,function(c,l,f){a[++s]=t(c,l,f)}),a}function Ia(e){var t=mn(e);return t.length==1&&t[0][2]?rc(t[0][0],t[0][1]):function(s){return s===e||en(s,e,t)}}function Pa(e,t){return _n(e)&&ic(t)?rc(gt(e),t):function(s){var a=An(s,e);return a===i&&a===t?Tn(s,e):Ki(t,a,O|te)}}function Mr(e,t,s,a,c){e!==t&&Js(t,function(l,f){if(c||(c=new ct),ge(l))td(e,t,f,s,Mr,a,c);else{var g=a?a(En(e,f),l,f+"",e,t,c):i;g===i&&(g=l),Gs(e,f,g)}},ze)}function td(e,t,s,a,c,l,f){var g=En(e,s),m=En(t,s),I=f.get(m);if(I){Gs(e,s,I);return}var P=l?l(g,m,s+"",e,t,f):i,S=P===i;if(S){var C=k(m),N=!C&&kt(m),j=!C&&!N&&_i(m);P=m,C||N||j?k(g)?P=g:ve(g)?P=je(g):N?(S=!1,P=La(m,!0)):j?(S=!1,P=ja(m,!0)):P=[]:Yi(m)||ii(m)?(P=g,ii(g)?P=qc(g):(!ge(g)||Rt(g))&&(P=tc(m))):S=!1}S&&(f.set(m,P),c(P,m,a,l,f),f.delete(m)),Gs(e,s,P)}function Sa(e,t){var s=e.length;if(s)return t+=t<0?s:0,xt(t,s)?e[t]:i}function xa(e,t,s){t.length?t=pe(t,function(l){return k(l)?function(f){return Xt(f,l.length===1?l[0]:l)}:l}):t=[Ue];var a=-1;t=pe(t,He(L()));var c=Ea(e,function(l,f,g){var m=pe(t,function(I){return I(l)});return{criteria:m,index:++a,value:l}});return Cl(c,function(l,f){return fd(l,f,s)})}function id(e,t){return Ra(e,t,function(s,a){return Tn(e,a)})}function Ra(e,t,s){for(var a=-1,c=t.length,l={};++a<c;){var f=t[a],g=Xt(e,f);s(g,f)&&Wi(l,zt(f,e),g)}return l}function rd(e){return function(t){return Xt(t,e)}}function sn(e,t,s,a){var c=a?Rl:hi,l=-1,f=t.length,g=e;for(e===t&&(t=je(t)),s&&(g=pe(e,He(s)));++l<f;)for(var m=0,I=t[l],P=s?s(I):I;(m=c(g,P,m,a))>-1;)g!==e&&Cr.call(g,m,1),Cr.call(e,m,1);return e}function Ca(e,t){for(var s=e?t.length:0,a=s-1;s--;){var c=t[s];if(s==a||c!==l){var l=c;xt(c)?Cr.call(e,c,1):cn(e,c)}}return e}function nn(e,t){return e+Tr(ca()*(t-e+1))}function sd(e,t,s,a){for(var c=-1,l=Ee(Ar((t-e)/(s||1)),0),f=w(l);l--;)f[a?l:++c]=e,e+=s;return f}function on(e,t){var s="";if(!e||t<1||t>ce)return s;do t%2&&(s+=e),t=Tr(t/2),t&&(e+=e);while(t);return s}function B(e,t){return In(sc(e,t,Ue),e+"")}function nd(e){return la(bi(e))}function od(e,t){var s=bi(e);return Gr(s,Zt(t,0,s.length))}function Wi(e,t,s,a){if(!ge(e))return e;t=zt(t,e);for(var c=-1,l=t.length,f=l-1,g=e;g!=null&&++c<l;){var m=gt(t[c]),I=s;if(m==="__proto__"||m==="constructor"||m==="prototype")return e;if(c!=f){var P=g[m];I=a?a(P,m,g):i,I===i&&(I=ge(P)?P:xt(t[c+1])?[]:{})}Fi(g,m,I),g=g[m]}return e}var Oa=Nr?function(e,t){return Nr.set(e,t),e}:Ue,ad=Or?function(e,t){return Or(e,"toString",{configurable:!0,enumerable:!1,value:qn(t),writable:!0})}:Ue;function cd(e){return Gr(bi(e))}function tt(e,t,s){var a=-1,c=e.length;t<0&&(t=-t>c?0:c+t),s=s>c?c:s,s<0&&(s+=c),c=t>s?0:s-t>>>0,t>>>=0;for(var l=w(c);++a<c;)l[a]=e[a+t];return l}function hd(e,t){var s;return jt(e,function(a,c,l){return s=t(a,c,l),!s}),!!s}function zr(e,t,s){var a=0,c=e==null?a:e.length;if(typeof t=="number"&&t===t&&c<=lu){for(;a<c;){var l=a+c>>>1,f=e[l];f!==null&&!Ke(f)&&(s?f<=t:f<t)?a=l+1:c=l}return c}return an(e,t,Ue,s)}function an(e,t,s,a){var c=0,l=e==null?0:e.length;if(l===0)return 0;t=s(t);for(var f=t!==t,g=t===null,m=Ke(t),I=t===i;c<l;){var P=Tr((c+l)/2),S=s(e[P]),C=S!==i,N=S===null,j=S===S,H=Ke(S);if(f)var M=a||j;else I?M=j&&(a||C):g?M=j&&C&&(a||!N):m?M=j&&C&&!N&&(a||!H):N||H?M=!1:M=a?S<=t:S<t;M?c=P+1:l=P}return Ae(l,Oi)}function Aa(e,t){for(var s=-1,a=e.length,c=0,l=[];++s<a;){var f=e[s],g=t?t(f):f;if(!s||!ht(g,m)){var m=g;l[c++]=f===0?0:f}}return l}function Ta(e){return typeof e=="number"?e:Ke(e)?wt:+e}function Be(e){if(typeof e=="string")return e;if(k(e))return pe(e,Be)+"";if(Ke(e))return ha?ha.call(e):"";var t=e+"";return t=="0"&&1/e==-le?"-0":t}function Mt(e,t,s){var a=-1,c=mr,l=e.length,f=!0,g=[],m=g;if(s)f=!1,c=Ds;else if(l>=o){var I=t?null:_d(e);if(I)return _r(I);f=!1,c=ji,m=new Yt}else m=t?[]:g;e:for(;++a<l;){var P=e[a],S=t?t(P):P;if(P=s||P!==0?P:0,f&&S===S){for(var C=m.length;C--;)if(m[C]===S)continue e;t&&m.push(S),g.push(P)}else c(m,S,s)||(m!==g&&m.push(S),g.push(P))}return g}function cn(e,t){return t=zt(t,e),e=nc(e,t),e==null||delete e[gt(it(t))]}function Na(e,t,s,a){return Wi(e,t,s(Xt(e,t)),a)}function Ur(e,t,s,a){for(var c=e.length,l=a?c:-1;(a?l--:++l<c)&&t(e[l],l,e););return s?tt(e,a?0:l,a?l+1:c):tt(e,a?l+1:0,a?c:l)}function qa(e,t){var s=e;return s instanceof W&&(s=s.value()),Ls(t,function(a,c){return c.func.apply(c.thisArg,$t([a],c.args))},s)}function hn(e,t,s){var a=e.length;if(a<2)return a?Mt(e[0]):[];for(var c=-1,l=w(a);++c<a;)for(var f=e[c],g=-1;++g<a;)g!=c&&(l[c]=Hi(l[c]||f,e[g],t,s));return Mt(Re(l,1),t,s)}function $a(e,t,s){for(var a=-1,c=e.length,l=t.length,f={};++a<c;){var g=a<l?t[a]:i;s(f,e[a],g)}return f}function un(e){return ve(e)?e:[]}function ln(e){return typeof e=="function"?e:Ue}function zt(e,t){return k(e)?e:_n(e,t)?[e]:hc(ee(e))}var ud=B;function Ut(e,t,s){var a=e.length;return s=s===i?a:s,!t&&s>=a?e:tt(e,t,s)}var Da=Yl||function(e){return xe.clearTimeout(e)};function La(e,t){if(t)return e.slice();var s=e.length,a=ra?ra(s):new e.constructor(s);return e.copy(a),a}function pn(e){var t=new e.constructor(e.byteLength);return new xr(t).set(new xr(e)),t}function ld(e,t){var s=t?pn(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function pd(e){var t=new e.constructor(e.source,wo.exec(e));return t.lastIndex=e.lastIndex,t}function dd(e){return Vi?oe(Vi.call(e)):{}}function ja(e,t){var s=t?pn(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Ma(e,t){if(e!==t){var s=e!==i,a=e===null,c=e===e,l=Ke(e),f=t!==i,g=t===null,m=t===t,I=Ke(t);if(!g&&!I&&!l&&e>t||l&&f&&m&&!g&&!I||a&&f&&m||!s&&m||!c)return 1;if(!a&&!l&&!I&&e<t||I&&s&&c&&!a&&!l||g&&s&&c||!f&&c||!m)return-1}return 0}function fd(e,t,s){for(var a=-1,c=e.criteria,l=t.criteria,f=c.length,g=s.length;++a<f;){var m=Ma(c[a],l[a]);if(m){if(a>=g)return m;var I=s[a];return m*(I=="desc"?-1:1)}}return e.index-t.index}function za(e,t,s,a){for(var c=-1,l=e.length,f=s.length,g=-1,m=t.length,I=Ee(l-f,0),P=w(m+I),S=!a;++g<m;)P[g]=t[g];for(;++c<f;)(S||c<l)&&(P[s[c]]=e[c]);for(;I--;)P[g++]=e[c++];return P}function Ua(e,t,s,a){for(var c=-1,l=e.length,f=-1,g=s.length,m=-1,I=t.length,P=Ee(l-g,0),S=w(P+I),C=!a;++c<P;)S[c]=e[c];for(var N=c;++m<I;)S[N+m]=t[m];for(;++f<g;)(C||c<l)&&(S[N+s[f]]=e[c++]);return S}function je(e,t){var s=-1,a=e.length;for(t||(t=w(a));++s<a;)t[s]=e[s];return t}function ft(e,t,s,a){var c=!s;s||(s={});for(var l=-1,f=t.length;++l<f;){var g=t[l],m=a?a(s[g],e[g],g,s,e):i;m===i&&(m=e[g]),c?It(s,g,m):Fi(s,g,m)}return s}function gd(e,t){return ft(e,wn(e),t)}function yd(e,t){return ft(e,Xa(e),t)}function kr(e,t){return function(s,a){var c=k(s)?bl:Mp,l=t?t():{};return c(s,e,L(a,2),l)}}function vi(e){return B(function(t,s){var a=-1,c=s.length,l=c>1?s[c-1]:i,f=c>2?s[2]:i;for(l=e.length>3&&typeof l=="function"?(c--,l):i,f&&$e(s[0],s[1],f)&&(l=c<3?i:l,c=1),t=oe(t);++a<c;){var g=s[a];g&&e(t,g,a,l)}return t})}function ka(e,t){return function(s,a){if(s==null)return s;if(!Me(s))return e(s,a);for(var c=s.length,l=t?c:-1,f=oe(s);(t?l--:++l<c)&&a(f[l],l,f)!==!1;);return s}}function Va(e){return function(t,s,a){for(var c=-1,l=oe(t),f=a(t),g=f.length;g--;){var m=f[e?g:++c];if(s(l[m],m,l)===!1)break}return t}}function vd(e,t,s){var a=t&se,c=Gi(e);function l(){var f=this&&this!==xe&&this instanceof l?c:e;return f.apply(a?s:this,arguments)}return l}function Fa(e){return function(t){t=ee(t);var s=ui(t)?at(t):i,a=s?s[0]:t.charAt(0),c=s?Ut(s,1).join(""):t.slice(1);return a[e]()+c}}function mi(e){return function(t){return Ls(kc(Uc(t).replace(al,"")),e,"")}}function Gi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=yi(e.prototype),a=e.apply(s,t);return ge(a)?a:s}}function md(e,t,s){var a=Gi(e);function c(){for(var l=arguments.length,f=w(l),g=l,m=wi(c);g--;)f[g]=arguments[g];var I=l<3&&f[0]!==m&&f[l-1]!==m?[]:Dt(f,m);if(l-=I.length,l<s)return Ga(e,t,Vr,c.placeholder,i,f,I,i,i,s-l);var P=this&&this!==xe&&this instanceof c?a:e;return Fe(P,this,f)}return c}function Ha(e){return function(t,s,a){var c=oe(t);if(!Me(t)){var l=L(s,3);t=Ie(t),s=function(g){return l(c[g],g,c)}}var f=e(t,s,a);return f>-1?c[l?t[f]:f]:i}}function Ba(e){return St(function(t){var s=t.length,a=s,c=Xe.prototype.thru;for(e&&t.reverse();a--;){var l=t[a];if(typeof l!="function")throw new Ze(d);if(c&&!f&&Kr(l)=="wrapper")var f=new Xe([],!0)}for(a=f?a:s;++a<s;){l=t[a];var g=Kr(l),m=g=="wrapper"?vn(l):i;m&&bn(m[0])&&m[1]==(de|X|ne|fe)&&!m[4].length&&m[9]==1?f=f[Kr(m[0])].apply(f,m[3]):f=l.length==1&&bn(l)?f[g]():f.thru(l)}return function(){var I=arguments,P=I[0];if(f&&I.length==1&&k(P))return f.plant(P).value();for(var S=0,C=s?t[S].apply(this,I):P;++S<s;)C=t[S].call(this,C);return C}})}function Vr(e,t,s,a,c,l,f,g,m,I){var P=t&de,S=t&se,C=t&ae,N=t&(X|J),j=t&pt,H=C?i:Gi(e);function M(){for(var K=arguments.length,Q=w(K),We=K;We--;)Q[We]=arguments[We];if(N)var De=wi(M),Ge=Al(Q,De);if(a&&(Q=za(Q,a,c,N)),l&&(Q=Ua(Q,l,f,N)),K-=Ge,N&&K<I){var me=Dt(Q,De);return Ga(e,t,Vr,M.placeholder,s,Q,me,g,m,I-K)}var ut=S?s:this,Ot=C?ut[e]:e;return K=Q.length,g?Q=Md(Q,g):j&&K>1&&Q.reverse(),P&&m<K&&(Q.length=m),this&&this!==xe&&this instanceof M&&(Ot=H||Gi(Ot)),Ot.apply(ut,Q)}return M}function Ka(e,t){return function(s,a){return Kp(s,e,t(a),{})}}function Fr(e,t){return function(s,a){var c;if(s===i&&a===i)return t;if(s!==i&&(c=s),a!==i){if(c===i)return a;typeof s=="string"||typeof a=="string"?(s=Be(s),a=Be(a)):(s=Ta(s),a=Ta(a)),c=e(s,a)}return c}}function dn(e){return St(function(t){return t=pe(t,He(L())),B(function(s){var a=this;return e(t,function(c){return Fe(c,a,s)})})})}function Hr(e,t){t=t===i?" ":Be(t);var s=t.length;if(s<2)return s?on(t,e):t;var a=on(t,Ar(e/li(t)));return ui(t)?Ut(at(a),0,e).join(""):a.slice(0,e)}function wd(e,t,s,a){var c=t&se,l=Gi(e);function f(){for(var g=-1,m=arguments.length,I=-1,P=a.length,S=w(P+m),C=this&&this!==xe&&this instanceof f?l:e;++I<P;)S[I]=a[I];for(;m--;)S[I++]=arguments[++g];return Fe(C,c?s:this,S)}return f}function Wa(e){return function(t,s,a){return a&&typeof a!="number"&&$e(t,s,a)&&(s=a=i),t=Ct(t),s===i?(s=t,t=0):s=Ct(s),a=a===i?t<s?1:-1:Ct(a),sd(t,s,a,e)}}function Br(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=rt(t),s=rt(s)),e(t,s)}}function Ga(e,t,s,a,c,l,f,g,m,I){var P=t&X,S=P?f:i,C=P?i:f,N=P?l:i,j=P?i:l;t|=P?ne:Se,t&=~(P?Se:ne),t&Pe||(t&=~(se|ae));var H=[e,t,c,N,S,j,C,g,m,I],M=s.apply(i,H);return bn(e)&&oc(M,H),M.placeholder=a,ac(M,e,t)}function fn(e){var t=be[e];return function(s,a){if(s=rt(s),a=a==null?0:Ae(V(a),292),a&&aa(s)){var c=(ee(s)+"e").split("e"),l=t(c[0]+"e"+(+c[1]+a));return c=(ee(l)+"e").split("e"),+(c[0]+"e"+(+c[1]-a))}return t(s)}}var _d=fi&&1/_r(new fi([,-0]))[1]==le?function(e){return new fi(e)}:Ln;function Qa(e){return function(t){var s=Te(t);return s==nt?Fs(t):s==ot?jl(t):Ol(t,e(t))}}function Pt(e,t,s,a,c,l,f,g){var m=t&ae;if(!m&&typeof e!="function")throw new Ze(d);var I=a?a.length:0;if(I||(t&=~(ne|Se),a=c=i),f=f===i?f:Ee(V(f),0),g=g===i?g:V(g),I-=c?c.length:0,t&Se){var P=a,S=c;a=c=i}var C=m?i:vn(e),N=[e,t,s,a,c,P,S,l,f,g];if(C&&Dd(N,C),e=N[0],t=N[1],s=N[2],a=N[3],c=N[4],g=N[9]=N[9]===i?m?0:e.length:Ee(N[9]-I,0),!g&&t&(X|J)&&(t&=~(X|J)),!t||t==se)var j=vd(e,t,s);else t==X||t==J?j=md(e,t,g):(t==ne||t==(se|ne))&&!c.length?j=wd(e,t,s,a):j=Vr.apply(i,N);var H=C?Oa:oc;return ac(H(j,N),e,t)}function Ja(e,t,s,a){return e===i||ht(e,di[s])&&!re.call(a,s)?t:e}function Ya(e,t,s,a,c,l){return ge(e)&&ge(t)&&(l.set(t,e),Mr(e,t,i,Ya,l),l.delete(t)),e}function bd(e){return Yi(e)?i:e}function Za(e,t,s,a,c,l){var f=s&O,g=e.length,m=t.length;if(g!=m&&!(f&&m>g))return!1;var I=l.get(e),P=l.get(t);if(I&&P)return I==t&&P==e;var S=-1,C=!0,N=s&te?new Yt:i;for(l.set(e,t),l.set(t,e);++S<g;){var j=e[S],H=t[S];if(a)var M=f?a(H,j,S,t,e,l):a(j,H,S,e,t,l);if(M!==i){if(M)continue;C=!1;break}if(N){if(!js(t,function(K,Q){if(!ji(N,Q)&&(j===K||c(j,K,s,a,l)))return N.push(Q)})){C=!1;break}}else if(!(j===H||c(j,H,s,a,l))){C=!1;break}}return l.delete(e),l.delete(t),C}function Ed(e,t,s,a,c,l,f){switch(s){case ai:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Li:return!(e.byteLength!=t.byteLength||!l(new xr(e),new xr(t)));case Ai:case Ti:case Ni:return ht(+e,+t);case pr:return e.name==t.name&&e.message==t.message;case qi:case $i:return e==t+"";case nt:var g=Fs;case ot:var m=a&O;if(g||(g=_r),e.size!=t.size&&!m)return!1;var I=f.get(e);if(I)return I==t;a|=te,f.set(e,t);var P=Za(g(e),g(t),a,c,l,f);return f.delete(e),P;case fr:if(Vi)return Vi.call(e)==Vi.call(t)}return!1}function Id(e,t,s,a,c,l){var f=s&O,g=gn(e),m=g.length,I=gn(t),P=I.length;if(m!=P&&!f)return!1;for(var S=m;S--;){var C=g[S];if(!(f?C in t:re.call(t,C)))return!1}var N=l.get(e),j=l.get(t);if(N&&j)return N==t&&j==e;var H=!0;l.set(e,t),l.set(t,e);for(var M=f;++S<m;){C=g[S];var K=e[C],Q=t[C];if(a)var We=f?a(Q,K,C,t,e,l):a(K,Q,C,e,t,l);if(!(We===i?K===Q||c(K,Q,s,a,l):We)){H=!1;break}M||(M=C=="constructor")}if(H&&!M){var De=e.constructor,Ge=t.constructor;De!=Ge&&"constructor"in e&&"constructor"in t&&!(typeof De=="function"&&De instanceof De&&typeof Ge=="function"&&Ge instanceof Ge)&&(H=!1)}return l.delete(e),l.delete(t),H}function St(e){return In(sc(e,i,dc),e+"")}function gn(e){return ma(e,Ie,wn)}function yn(e){return ma(e,ze,Xa)}var vn=Nr?function(e){return Nr.get(e)}:Ln;function Kr(e){for(var t=e.name+"",s=gi[t],a=re.call(gi,t)?s.length:0;a--;){var c=s[a],l=c.func;if(l==null||l==e)return c.name}return t}function wi(e){var t=re.call(u,"placeholder")?u:e;return t.placeholder}function L(){var e=u.iteratee||$n;return e=e===$n?ba:e,arguments.length?e(arguments[0],arguments[1]):e}function Wr(e,t){var s=e.__data__;return Td(t)?s[typeof t=="string"?"string":"hash"]:s.map}function mn(e){for(var t=Ie(e),s=t.length;s--;){var a=t[s],c=e[a];t[s]=[a,c,ic(c)]}return t}function ei(e,t){var s=$l(e,t);return _a(s)?s:i}function Pd(e){var t=re.call(e,Qt),s=e[Qt];try{e[Qt]=i;var a=!0}catch{}var c=Pr.call(e);return a&&(t?e[Qt]=s:delete e[Qt]),c}var wn=Bs?function(e){return e==null?[]:(e=oe(e),qt(Bs(e),function(t){return na.call(e,t)}))}:jn,Xa=Bs?function(e){for(var t=[];e;)$t(t,wn(e)),e=Rr(e);return t}:jn,Te=qe;(Ks&&Te(new Ks(new ArrayBuffer(1)))!=ai||zi&&Te(new zi)!=nt||Ws&&Te(Ws.resolve())!=go||fi&&Te(new fi)!=ot||Ui&&Te(new Ui)!=Di)&&(Te=function(e){var t=qe(e),s=t==_t?e.constructor:i,a=s?ti(s):"";if(a)switch(a){case op:return ai;case ap:return nt;case cp:return go;case hp:return ot;case up:return Di}return t});function Sd(e,t,s){for(var a=-1,c=s.length;++a<c;){var l=s[a],f=l.size;switch(l.type){case"drop":e+=f;break;case"dropRight":t-=f;break;case"take":t=Ae(t,e+f);break;case"takeRight":e=Ee(e,t-f);break}}return{start:e,end:t}}function xd(e){var t=e.match(Nu);return t?t[1].split(qu):[]}function ec(e,t,s){t=zt(t,e);for(var a=-1,c=t.length,l=!1;++a<c;){var f=gt(t[a]);if(!(l=e!=null&&s(e,f)))break;e=e[f]}return l||++a!=c?l:(c=e==null?0:e.length,!!c&&es(c)&&xt(f,c)&&(k(e)||ii(e)))}function Rd(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&re.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function tc(e){return typeof e.constructor=="function"&&!Qi(e)?yi(Rr(e)):{}}function Cd(e,t,s){var a=e.constructor;switch(t){case Li:return pn(e);case Ai:case Ti:return new a(+e);case ai:return ld(e,s);case vs:case ms:case ws:case _s:case bs:case Es:case Is:case Ps:case Ss:return ja(e,s);case nt:return new a;case Ni:case $i:return new a(e);case qi:return pd(e);case ot:return new a;case fr:return dd(e)}}function Od(e,t){var s=t.length;if(!s)return e;var a=s-1;return t[a]=(s>1?"& ":"")+t[a],t=t.join(s>2?", ":" "),e.replace(Tu,`{
/* [wrapped with `+t+`] */
`)}function Ad(e){return k(e)||ii(e)||!!(oa&&e&&e[oa])}function xt(e,t){var s=typeof e;return t=t??ce,!!t&&(s=="number"||s!="symbol"&&Vu.test(e))&&e>-1&&e%1==0&&e<t}function $e(e,t,s){if(!ge(s))return!1;var a=typeof t;return(a=="number"?Me(s)&&xt(t,s.length):a=="string"&&t in s)?ht(s[t],e):!1}function _n(e,t){if(k(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||Ke(e)?!0:Ru.test(e)||!xu.test(e)||t!=null&&e in oe(t)}function Td(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function bn(e){var t=Kr(e),s=u[t];if(typeof s!="function"||!(t in W.prototype))return!1;if(e===s)return!0;var a=vn(s);return!!a&&e===a[0]}function Nd(e){return!!ia&&ia in e}var qd=Er?Rt:Mn;function Qi(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||di;return e===s}function ic(e){return e===e&&!ge(e)}function rc(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==i||e in oe(s))}}function $d(e){var t=Zr(e,function(a){return s.size===x&&s.clear(),a}),s=t.cache;return t}function Dd(e,t){var s=e[1],a=t[1],c=s|a,l=c<(se|ae|de),f=a==de&&s==X||a==de&&s==fe&&e[7].length<=t[8]||a==(de|fe)&&t[7].length<=t[8]&&s==X;if(!(l||f))return e;a&se&&(e[2]=t[2],c|=s&se?0:Pe);var g=t[3];if(g){var m=e[3];e[3]=m?za(m,g,t[4]):g,e[4]=m?Dt(e[3],q):t[4]}return g=t[5],g&&(m=e[5],e[5]=m?Ua(m,g,t[6]):g,e[6]=m?Dt(e[5],q):t[6]),g=t[7],g&&(e[7]=g),a&de&&(e[8]=e[8]==null?t[8]:Ae(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=c,e}function Ld(e){var t=[];if(e!=null)for(var s in oe(e))t.push(s);return t}function jd(e){return Pr.call(e)}function sc(e,t,s){return t=Ee(t===i?e.length-1:t,0),function(){for(var a=arguments,c=-1,l=Ee(a.length-t,0),f=w(l);++c<l;)f[c]=a[t+c];c=-1;for(var g=w(t+1);++c<t;)g[c]=a[c];return g[t]=s(f),Fe(e,this,g)}}function nc(e,t){return t.length<2?e:Xt(e,tt(t,0,-1))}function Md(e,t){for(var s=e.length,a=Ae(t.length,s),c=je(e);a--;){var l=t[a];e[a]=xt(l,s)?c[l]:i}return e}function En(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var oc=cc(Oa),Ji=Xl||function(e,t){return xe.setTimeout(e,t)},In=cc(ad);function ac(e,t,s){var a=t+"";return In(e,Od(a,zd(xd(a),s)))}function cc(e){var t=0,s=0;return function(){var a=rp(),c=Ci-(a-s);if(s=a,c>0){if(++t>=ys)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Gr(e,t){var s=-1,a=e.length,c=a-1;for(t=t===i?a:t;++s<t;){var l=nn(s,c),f=e[l];e[l]=e[s],e[s]=f}return e.length=t,e}var hc=$d(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Cu,function(s,a,c,l){t.push(c?l.replace(Lu,"$1"):a||s)}),t});function gt(e){if(typeof e=="string"||Ke(e))return e;var t=e+"";return t=="0"&&1/e==-le?"-0":t}function ti(e){if(e!=null){try{return Ir.call(e)}catch{}try{return e+""}catch{}}return""}function zd(e,t){return Ye(pu,function(s){var a="_."+s[0];t&s[1]&&!mr(e,a)&&e.push(a)}),e.sort()}function uc(e){if(e instanceof W)return e.clone();var t=new Xe(e.__wrapped__,e.__chain__);return t.__actions__=je(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Ud(e,t,s){(s?$e(e,t,s):t===i)?t=1:t=Ee(V(t),0);var a=e==null?0:e.length;if(!a||t<1)return[];for(var c=0,l=0,f=w(Ar(a/t));c<a;)f[l++]=tt(e,c,c+=t);return f}function kd(e){for(var t=-1,s=e==null?0:e.length,a=0,c=[];++t<s;){var l=e[t];l&&(c[a++]=l)}return c}function Vd(){var e=arguments.length;if(!e)return[];for(var t=w(e-1),s=arguments[0],a=e;a--;)t[a-1]=arguments[a];return $t(k(s)?je(s):[s],Re(t,1))}var Fd=B(function(e,t){return ve(e)?Hi(e,Re(t,1,ve,!0)):[]}),Hd=B(function(e,t){var s=it(t);return ve(s)&&(s=i),ve(e)?Hi(e,Re(t,1,ve,!0),L(s,2)):[]}),Bd=B(function(e,t){var s=it(t);return ve(s)&&(s=i),ve(e)?Hi(e,Re(t,1,ve,!0),i,s):[]});function Kd(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:V(t),tt(e,t<0?0:t,a)):[]}function Wd(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:V(t),t=a-t,tt(e,0,t<0?0:t)):[]}function Gd(e,t){return e&&e.length?Ur(e,L(t,3),!0,!0):[]}function Qd(e,t){return e&&e.length?Ur(e,L(t,3),!0):[]}function Jd(e,t,s,a){var c=e==null?0:e.length;return c?(s&&typeof s!="number"&&$e(e,t,s)&&(s=0,a=c),Vp(e,t,s,a)):[]}function lc(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var c=s==null?0:V(s);return c<0&&(c=Ee(a+c,0)),wr(e,L(t,3),c)}function pc(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var c=a-1;return s!==i&&(c=V(s),c=s<0?Ee(a+c,0):Ae(c,a-1)),wr(e,L(t,3),c,!0)}function dc(e){var t=e==null?0:e.length;return t?Re(e,1):[]}function Yd(e){var t=e==null?0:e.length;return t?Re(e,le):[]}function Zd(e,t){var s=e==null?0:e.length;return s?(t=t===i?1:V(t),Re(e,t)):[]}function Xd(e){for(var t=-1,s=e==null?0:e.length,a={};++t<s;){var c=e[t];a[c[0]]=c[1]}return a}function fc(e){return e&&e.length?e[0]:i}function ef(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var c=s==null?0:V(s);return c<0&&(c=Ee(a+c,0)),hi(e,t,c)}function tf(e){var t=e==null?0:e.length;return t?tt(e,0,-1):[]}var rf=B(function(e){var t=pe(e,un);return t.length&&t[0]===e[0]?Xs(t):[]}),sf=B(function(e){var t=it(e),s=pe(e,un);return t===it(s)?t=i:s.pop(),s.length&&s[0]===e[0]?Xs(s,L(t,2)):[]}),nf=B(function(e){var t=it(e),s=pe(e,un);return t=typeof t=="function"?t:i,t&&s.pop(),s.length&&s[0]===e[0]?Xs(s,i,t):[]});function of(e,t){return e==null?"":tp.call(e,t)}function it(e){var t=e==null?0:e.length;return t?e[t-1]:i}function af(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var c=a;return s!==i&&(c=V(s),c=c<0?Ee(a+c,0):Ae(c,a-1)),t===t?zl(e,t,c):wr(e,Go,c,!0)}function cf(e,t){return e&&e.length?Sa(e,V(t)):i}var hf=B(gc);function gc(e,t){return e&&e.length&&t&&t.length?sn(e,t):e}function uf(e,t,s){return e&&e.length&&t&&t.length?sn(e,t,L(s,2)):e}function lf(e,t,s){return e&&e.length&&t&&t.length?sn(e,t,i,s):e}var pf=St(function(e,t){var s=e==null?0:e.length,a=Qs(e,t);return Ca(e,pe(t,function(c){return xt(c,s)?+c:c}).sort(Ma)),a});function df(e,t){var s=[];if(!(e&&e.length))return s;var a=-1,c=[],l=e.length;for(t=L(t,3);++a<l;){var f=e[a];t(f,a,e)&&(s.push(f),c.push(a))}return Ca(e,c),s}function Pn(e){return e==null?e:np.call(e)}function ff(e,t,s){var a=e==null?0:e.length;return a?(s&&typeof s!="number"&&$e(e,t,s)?(t=0,s=a):(t=t==null?0:V(t),s=s===i?a:V(s)),tt(e,t,s)):[]}function gf(e,t){return zr(e,t)}function yf(e,t,s){return an(e,t,L(s,2))}function vf(e,t){var s=e==null?0:e.length;if(s){var a=zr(e,t);if(a<s&&ht(e[a],t))return a}return-1}function mf(e,t){return zr(e,t,!0)}function wf(e,t,s){return an(e,t,L(s,2),!0)}function _f(e,t){var s=e==null?0:e.length;if(s){var a=zr(e,t,!0)-1;if(ht(e[a],t))return a}return-1}function bf(e){return e&&e.length?Aa(e):[]}function Ef(e,t){return e&&e.length?Aa(e,L(t,2)):[]}function If(e){var t=e==null?0:e.length;return t?tt(e,1,t):[]}function Pf(e,t,s){return e&&e.length?(t=s||t===i?1:V(t),tt(e,0,t<0?0:t)):[]}function Sf(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:V(t),t=a-t,tt(e,t<0?0:t,a)):[]}function xf(e,t){return e&&e.length?Ur(e,L(t,3),!1,!0):[]}function Rf(e,t){return e&&e.length?Ur(e,L(t,3)):[]}var Cf=B(function(e){return Mt(Re(e,1,ve,!0))}),Of=B(function(e){var t=it(e);return ve(t)&&(t=i),Mt(Re(e,1,ve,!0),L(t,2))}),Af=B(function(e){var t=it(e);return t=typeof t=="function"?t:i,Mt(Re(e,1,ve,!0),i,t)});function Tf(e){return e&&e.length?Mt(e):[]}function Nf(e,t){return e&&e.length?Mt(e,L(t,2)):[]}function qf(e,t){return t=typeof t=="function"?t:i,e&&e.length?Mt(e,i,t):[]}function Sn(e){if(!(e&&e.length))return[];var t=0;return e=qt(e,function(s){if(ve(s))return t=Ee(s.length,t),!0}),ks(t,function(s){return pe(e,Ms(s))})}function yc(e,t){if(!(e&&e.length))return[];var s=Sn(e);return t==null?s:pe(s,function(a){return Fe(t,i,a)})}var $f=B(function(e,t){return ve(e)?Hi(e,t):[]}),Df=B(function(e){return hn(qt(e,ve))}),Lf=B(function(e){var t=it(e);return ve(t)&&(t=i),hn(qt(e,ve),L(t,2))}),jf=B(function(e){var t=it(e);return t=typeof t=="function"?t:i,hn(qt(e,ve),i,t)}),Mf=B(Sn);function zf(e,t){return $a(e||[],t||[],Fi)}function Uf(e,t){return $a(e||[],t||[],Wi)}var kf=B(function(e){var t=e.length,s=t>1?e[t-1]:i;return s=typeof s=="function"?(e.pop(),s):i,yc(e,s)});function vc(e){var t=u(e);return t.__chain__=!0,t}function Vf(e,t){return t(e),e}function Qr(e,t){return t(e)}var Ff=St(function(e){var t=e.length,s=t?e[0]:0,a=this.__wrapped__,c=function(l){return Qs(l,e)};return t>1||this.__actions__.length||!(a instanceof W)||!xt(s)?this.thru(c):(a=a.slice(s,+s+(t?1:0)),a.__actions__.push({func:Qr,args:[c],thisArg:i}),new Xe(a,this.__chain__).thru(function(l){return t&&!l.length&&l.push(i),l}))});function Hf(){return vc(this)}function Bf(){return new Xe(this.value(),this.__chain__)}function Kf(){this.__values__===i&&(this.__values__=Tc(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function Wf(){return this}function Gf(e){for(var t,s=this;s instanceof $r;){var a=uc(s);a.__index__=0,a.__values__=i,t?c.__wrapped__=a:t=a;var c=a;s=s.__wrapped__}return c.__wrapped__=e,t}function Qf(){var e=this.__wrapped__;if(e instanceof W){var t=e;return this.__actions__.length&&(t=new W(this)),t=t.reverse(),t.__actions__.push({func:Qr,args:[Pn],thisArg:i}),new Xe(t,this.__chain__)}return this.thru(Pn)}function Jf(){return qa(this.__wrapped__,this.__actions__)}var Yf=kr(function(e,t,s){re.call(e,s)?++e[s]:It(e,s,1)});function Zf(e,t,s){var a=k(e)?Ko:kp;return s&&$e(e,t,s)&&(t=i),a(e,L(t,3))}function Xf(e,t){var s=k(e)?qt:ya;return s(e,L(t,3))}var eg=Ha(lc),tg=Ha(pc);function ig(e,t){return Re(Jr(e,t),1)}function rg(e,t){return Re(Jr(e,t),le)}function sg(e,t,s){return s=s===i?1:V(s),Re(Jr(e,t),s)}function mc(e,t){var s=k(e)?Ye:jt;return s(e,L(t,3))}function wc(e,t){var s=k(e)?El:ga;return s(e,L(t,3))}var ng=kr(function(e,t,s){re.call(e,s)?e[s].push(t):It(e,s,[t])});function og(e,t,s,a){e=Me(e)?e:bi(e),s=s&&!a?V(s):0;var c=e.length;return s<0&&(s=Ee(c+s,0)),ts(e)?s<=c&&e.indexOf(t,s)>-1:!!c&&hi(e,t,s)>-1}var ag=B(function(e,t,s){var a=-1,c=typeof t=="function",l=Me(e)?w(e.length):[];return jt(e,function(f){l[++a]=c?Fe(t,f,s):Bi(f,t,s)}),l}),cg=kr(function(e,t,s){It(e,s,t)});function Jr(e,t){var s=k(e)?pe:Ea;return s(e,L(t,3))}function hg(e,t,s,a){return e==null?[]:(k(t)||(t=t==null?[]:[t]),s=a?i:s,k(s)||(s=s==null?[]:[s]),xa(e,t,s))}var ug=kr(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function lg(e,t,s){var a=k(e)?Ls:Jo,c=arguments.length<3;return a(e,L(t,4),s,c,jt)}function pg(e,t,s){var a=k(e)?Il:Jo,c=arguments.length<3;return a(e,L(t,4),s,c,ga)}function dg(e,t){var s=k(e)?qt:ya;return s(e,Xr(L(t,3)))}function fg(e){var t=k(e)?la:nd;return t(e)}function gg(e,t,s){(s?$e(e,t,s):t===i)?t=1:t=V(t);var a=k(e)?Lp:od;return a(e,t)}function yg(e){var t=k(e)?jp:cd;return t(e)}function vg(e){if(e==null)return 0;if(Me(e))return ts(e)?li(e):e.length;var t=Te(e);return t==nt||t==ot?e.size:tn(e).length}function mg(e,t,s){var a=k(e)?js:hd;return s&&$e(e,t,s)&&(t=i),a(e,L(t,3))}var wg=B(function(e,t){if(e==null)return[];var s=t.length;return s>1&&$e(e,t[0],t[1])?t=[]:s>2&&$e(t[0],t[1],t[2])&&(t=[t[0]]),xa(e,Re(t,1),[])}),Yr=Zl||function(){return xe.Date.now()};function _g(e,t){if(typeof t!="function")throw new Ze(d);return e=V(e),function(){if(--e<1)return t.apply(this,arguments)}}function _c(e,t,s){return t=s?i:t,t=e&&t==null?e.length:t,Pt(e,de,i,i,i,i,t)}function bc(e,t){var s;if(typeof t!="function")throw new Ze(d);return e=V(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=i),s}}var xn=B(function(e,t,s){var a=se;if(s.length){var c=Dt(s,wi(xn));a|=ne}return Pt(e,a,t,s,c)}),Ec=B(function(e,t,s){var a=se|ae;if(s.length){var c=Dt(s,wi(Ec));a|=ne}return Pt(t,a,e,s,c)});function Ic(e,t,s){t=s?i:t;var a=Pt(e,X,i,i,i,i,i,t);return a.placeholder=Ic.placeholder,a}function Pc(e,t,s){t=s?i:t;var a=Pt(e,J,i,i,i,i,i,t);return a.placeholder=Pc.placeholder,a}function Sc(e,t,s){var a,c,l,f,g,m,I=0,P=!1,S=!1,C=!0;if(typeof e!="function")throw new Ze(d);t=rt(t)||0,ge(s)&&(P=!!s.leading,S="maxWait"in s,l=S?Ee(rt(s.maxWait)||0,t):l,C="trailing"in s?!!s.trailing:C);function N(me){var ut=a,Ot=c;return a=c=i,I=me,f=e.apply(Ot,ut),f}function j(me){return I=me,g=Ji(K,t),P?N(me):f}function H(me){var ut=me-m,Ot=me-I,Hc=t-ut;return S?Ae(Hc,l-Ot):Hc}function M(me){var ut=me-m,Ot=me-I;return m===i||ut>=t||ut<0||S&&Ot>=l}function K(){var me=Yr();if(M(me))return Q(me);g=Ji(K,H(me))}function Q(me){return g=i,C&&a?N(me):(a=c=i,f)}function We(){g!==i&&Da(g),I=0,a=m=c=g=i}function De(){return g===i?f:Q(Yr())}function Ge(){var me=Yr(),ut=M(me);if(a=arguments,c=this,m=me,ut){if(g===i)return j(m);if(S)return Da(g),g=Ji(K,t),N(m)}return g===i&&(g=Ji(K,t)),f}return Ge.cancel=We,Ge.flush=De,Ge}var bg=B(function(e,t){return fa(e,1,t)}),Eg=B(function(e,t,s){return fa(e,rt(t)||0,s)});function Ig(e){return Pt(e,pt)}function Zr(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Ze(d);var s=function(){var a=arguments,c=t?t.apply(this,a):a[0],l=s.cache;if(l.has(c))return l.get(c);var f=e.apply(this,a);return s.cache=l.set(c,f)||l,f};return s.cache=new(Zr.Cache||Et),s}Zr.Cache=Et;function Xr(e){if(typeof e!="function")throw new Ze(d);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Pg(e){return bc(2,e)}var Sg=ud(function(e,t){t=t.length==1&&k(t[0])?pe(t[0],He(L())):pe(Re(t,1),He(L()));var s=t.length;return B(function(a){for(var c=-1,l=Ae(a.length,s);++c<l;)a[c]=t[c].call(this,a[c]);return Fe(e,this,a)})}),Rn=B(function(e,t){var s=Dt(t,wi(Rn));return Pt(e,ne,i,t,s)}),xc=B(function(e,t){var s=Dt(t,wi(xc));return Pt(e,Se,i,t,s)}),xg=St(function(e,t){return Pt(e,fe,i,i,i,t)});function Rg(e,t){if(typeof e!="function")throw new Ze(d);return t=t===i?t:V(t),B(e,t)}function Cg(e,t){if(typeof e!="function")throw new Ze(d);return t=t==null?0:Ee(V(t),0),B(function(s){var a=s[t],c=Ut(s,0,t);return a&&$t(c,a),Fe(e,this,c)})}function Og(e,t,s){var a=!0,c=!0;if(typeof e!="function")throw new Ze(d);return ge(s)&&(a="leading"in s?!!s.leading:a,c="trailing"in s?!!s.trailing:c),Sc(e,t,{leading:a,maxWait:t,trailing:c})}function Ag(e){return _c(e,1)}function Tg(e,t){return Rn(ln(t),e)}function Ng(){if(!arguments.length)return[];var e=arguments[0];return k(e)?e:[e]}function qg(e){return et(e,G)}function $g(e,t){return t=typeof t=="function"?t:i,et(e,G,t)}function Dg(e){return et(e,$|G)}function Lg(e,t){return t=typeof t=="function"?t:i,et(e,$|G,t)}function jg(e,t){return t==null||da(e,t,Ie(t))}function ht(e,t){return e===t||e!==e&&t!==t}var Mg=Br(Zs),zg=Br(function(e,t){return e>=t}),ii=wa(function(){return arguments}())?wa:function(e){return ye(e)&&re.call(e,"callee")&&!na.call(e,"callee")},k=w.isArray,Ug=Uo?He(Uo):Wp;function Me(e){return e!=null&&es(e.length)&&!Rt(e)}function ve(e){return ye(e)&&Me(e)}function kg(e){return e===!0||e===!1||ye(e)&&qe(e)==Ai}var kt=ep||Mn,Vg=ko?He(ko):Gp;function Fg(e){return ye(e)&&e.nodeType===1&&!Yi(e)}function Hg(e){if(e==null)return!0;if(Me(e)&&(k(e)||typeof e=="string"||typeof e.splice=="function"||kt(e)||_i(e)||ii(e)))return!e.length;var t=Te(e);if(t==nt||t==ot)return!e.size;if(Qi(e))return!tn(e).length;for(var s in e)if(re.call(e,s))return!1;return!0}function Bg(e,t){return Ki(e,t)}function Kg(e,t,s){s=typeof s=="function"?s:i;var a=s?s(e,t):i;return a===i?Ki(e,t,i,s):!!a}function Cn(e){if(!ye(e))return!1;var t=qe(e);return t==pr||t==fu||typeof e.message=="string"&&typeof e.name=="string"&&!Yi(e)}function Wg(e){return typeof e=="number"&&aa(e)}function Rt(e){if(!ge(e))return!1;var t=qe(e);return t==dr||t==fo||t==du||t==yu}function Rc(e){return typeof e=="number"&&e==V(e)}function es(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ce}function ge(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function ye(e){return e!=null&&typeof e=="object"}var Cc=Vo?He(Vo):Jp;function Gg(e,t){return e===t||en(e,t,mn(t))}function Qg(e,t,s){return s=typeof s=="function"?s:i,en(e,t,mn(t),s)}function Jg(e){return Oc(e)&&e!=+e}function Yg(e){if(qd(e))throw new U(h);return _a(e)}function Zg(e){return e===null}function Xg(e){return e==null}function Oc(e){return typeof e=="number"||ye(e)&&qe(e)==Ni}function Yi(e){if(!ye(e)||qe(e)!=_t)return!1;var t=Rr(e);if(t===null)return!0;var s=re.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&Ir.call(s)==Gl}var On=Fo?He(Fo):Yp;function ey(e){return Rc(e)&&e>=-ce&&e<=ce}var Ac=Ho?He(Ho):Zp;function ts(e){return typeof e=="string"||!k(e)&&ye(e)&&qe(e)==$i}function Ke(e){return typeof e=="symbol"||ye(e)&&qe(e)==fr}var _i=Bo?He(Bo):Xp;function ty(e){return e===i}function iy(e){return ye(e)&&Te(e)==Di}function ry(e){return ye(e)&&qe(e)==mu}var sy=Br(rn),ny=Br(function(e,t){return e<=t});function Tc(e){if(!e)return[];if(Me(e))return ts(e)?at(e):je(e);if(Mi&&e[Mi])return Ll(e[Mi]());var t=Te(e),s=t==nt?Fs:t==ot?_r:bi;return s(e)}function Ct(e){if(!e)return e===0?e:0;if(e=rt(e),e===le||e===-le){var t=e<0?-1:1;return t*ie}return e===e?e:0}function V(e){var t=Ct(e),s=t%1;return t===t?s?t-s:t:0}function Nc(e){return e?Zt(V(e),0,Oe):0}function rt(e){if(typeof e=="number")return e;if(Ke(e))return wt;if(ge(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ge(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Yo(e);var s=zu.test(e);return s||ku.test(e)?wl(e.slice(2),s?2:8):Mu.test(e)?wt:+e}function qc(e){return ft(e,ze(e))}function oy(e){return e?Zt(V(e),-ce,ce):e===0?e:0}function ee(e){return e==null?"":Be(e)}var ay=vi(function(e,t){if(Qi(t)||Me(t)){ft(t,Ie(t),e);return}for(var s in t)re.call(t,s)&&Fi(e,s,t[s])}),$c=vi(function(e,t){ft(t,ze(t),e)}),is=vi(function(e,t,s,a){ft(t,ze(t),e,a)}),cy=vi(function(e,t,s,a){ft(t,Ie(t),e,a)}),hy=St(Qs);function uy(e,t){var s=yi(e);return t==null?s:pa(s,t)}var ly=B(function(e,t){e=oe(e);var s=-1,a=t.length,c=a>2?t[2]:i;for(c&&$e(t[0],t[1],c)&&(a=1);++s<a;)for(var l=t[s],f=ze(l),g=-1,m=f.length;++g<m;){var I=f[g],P=e[I];(P===i||ht(P,di[I])&&!re.call(e,I))&&(e[I]=l[I])}return e}),py=B(function(e){return e.push(i,Ya),Fe(Dc,i,e)});function dy(e,t){return Wo(e,L(t,3),dt)}function fy(e,t){return Wo(e,L(t,3),Ys)}function gy(e,t){return e==null?e:Js(e,L(t,3),ze)}function yy(e,t){return e==null?e:va(e,L(t,3),ze)}function vy(e,t){return e&&dt(e,L(t,3))}function my(e,t){return e&&Ys(e,L(t,3))}function wy(e){return e==null?[]:jr(e,Ie(e))}function _y(e){return e==null?[]:jr(e,ze(e))}function An(e,t,s){var a=e==null?i:Xt(e,t);return a===i?s:a}function by(e,t){return e!=null&&ec(e,t,Fp)}function Tn(e,t){return e!=null&&ec(e,t,Hp)}var Ey=Ka(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Pr.call(t)),e[t]=s},qn(Ue)),Iy=Ka(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Pr.call(t)),re.call(e,t)?e[t].push(s):e[t]=[s]},L),Py=B(Bi);function Ie(e){return Me(e)?ua(e):tn(e)}function ze(e){return Me(e)?ua(e,!0):ed(e)}function Sy(e,t){var s={};return t=L(t,3),dt(e,function(a,c,l){It(s,t(a,c,l),a)}),s}function xy(e,t){var s={};return t=L(t,3),dt(e,function(a,c,l){It(s,c,t(a,c,l))}),s}var Ry=vi(function(e,t,s){Mr(e,t,s)}),Dc=vi(function(e,t,s,a){Mr(e,t,s,a)}),Cy=St(function(e,t){var s={};if(e==null)return s;var a=!1;t=pe(t,function(l){return l=zt(l,e),a||(a=l.length>1),l}),ft(e,yn(e),s),a&&(s=et(s,$|D|G,bd));for(var c=t.length;c--;)cn(s,t[c]);return s});function Oy(e,t){return Lc(e,Xr(L(t)))}var Ay=St(function(e,t){return e==null?{}:id(e,t)});function Lc(e,t){if(e==null)return{};var s=pe(yn(e),function(a){return[a]});return t=L(t),Ra(e,s,function(a,c){return t(a,c[0])})}function Ty(e,t,s){t=zt(t,e);var a=-1,c=t.length;for(c||(c=1,e=i);++a<c;){var l=e==null?i:e[gt(t[a])];l===i&&(a=c,l=s),e=Rt(l)?l.call(e):l}return e}function Ny(e,t,s){return e==null?e:Wi(e,t,s)}function qy(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:Wi(e,t,s,a)}var jc=Qa(Ie),Mc=Qa(ze);function $y(e,t,s){var a=k(e),c=a||kt(e)||_i(e);if(t=L(t,4),s==null){var l=e&&e.constructor;c?s=a?new l:[]:ge(e)?s=Rt(l)?yi(Rr(e)):{}:s={}}return(c?Ye:dt)(e,function(f,g,m){return t(s,f,g,m)}),s}function Dy(e,t){return e==null?!0:cn(e,t)}function Ly(e,t,s){return e==null?e:Na(e,t,ln(s))}function jy(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:Na(e,t,ln(s),a)}function bi(e){return e==null?[]:Vs(e,Ie(e))}function My(e){return e==null?[]:Vs(e,ze(e))}function zy(e,t,s){return s===i&&(s=t,t=i),s!==i&&(s=rt(s),s=s===s?s:0),t!==i&&(t=rt(t),t=t===t?t:0),Zt(rt(e),t,s)}function Uy(e,t,s){return t=Ct(t),s===i?(s=t,t=0):s=Ct(s),e=rt(e),Bp(e,t,s)}function ky(e,t,s){if(s&&typeof s!="boolean"&&$e(e,t,s)&&(t=s=i),s===i&&(typeof t=="boolean"?(s=t,t=i):typeof e=="boolean"&&(s=e,e=i)),e===i&&t===i?(e=0,t=1):(e=Ct(e),t===i?(t=e,e=0):t=Ct(t)),e>t){var a=e;e=t,t=a}if(s||e%1||t%1){var c=ca();return Ae(e+c*(t-e+ml("1e-"+((c+"").length-1))),t)}return nn(e,t)}var Vy=mi(function(e,t,s){return t=t.toLowerCase(),e+(s?zc(t):t)});function zc(e){return Nn(ee(e).toLowerCase())}function Uc(e){return e=ee(e),e&&e.replace(Fu,Tl).replace(cl,"")}function Fy(e,t,s){e=ee(e),t=Be(t);var a=e.length;s=s===i?a:Zt(V(s),0,a);var c=s;return s-=t.length,s>=0&&e.slice(s,c)==t}function Hy(e){return e=ee(e),e&&Iu.test(e)?e.replace(vo,Nl):e}function By(e){return e=ee(e),e&&Ou.test(e)?e.replace(xs,"\\$&"):e}var Ky=mi(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),Wy=mi(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),Gy=Fa("toLowerCase");function Qy(e,t,s){e=ee(e),t=V(t);var a=t?li(e):0;if(!t||a>=t)return e;var c=(t-a)/2;return Hr(Tr(c),s)+e+Hr(Ar(c),s)}function Jy(e,t,s){e=ee(e),t=V(t);var a=t?li(e):0;return t&&a<t?e+Hr(t-a,s):e}function Yy(e,t,s){e=ee(e),t=V(t);var a=t?li(e):0;return t&&a<t?Hr(t-a,s)+e:e}function Zy(e,t,s){return s||t==null?t=0:t&&(t=+t),sp(ee(e).replace(Rs,""),t||0)}function Xy(e,t,s){return(s?$e(e,t,s):t===i)?t=1:t=V(t),on(ee(e),t)}function ev(){var e=arguments,t=ee(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var tv=mi(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function iv(e,t,s){return s&&typeof s!="number"&&$e(e,t,s)&&(t=s=i),s=s===i?Oe:s>>>0,s?(e=ee(e),e&&(typeof t=="string"||t!=null&&!On(t))&&(t=Be(t),!t&&ui(e))?Ut(at(e),0,s):e.split(t,s)):[]}var rv=mi(function(e,t,s){return e+(s?" ":"")+Nn(t)});function sv(e,t,s){return e=ee(e),s=s==null?0:Zt(V(s),0,e.length),t=Be(t),e.slice(s,s+t.length)==t}function nv(e,t,s){var a=u.templateSettings;s&&$e(e,t,s)&&(t=i),e=ee(e),t=is({},t,a,Ja);var c=is({},t.imports,a.imports,Ja),l=Ie(c),f=Vs(c,l),g,m,I=0,P=t.interpolate||gr,S="__p += '",C=Hs((t.escape||gr).source+"|"+P.source+"|"+(P===mo?ju:gr).source+"|"+(t.evaluate||gr).source+"|$","g"),N="//# sourceURL="+(re.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++dl+"]")+`
`;e.replace(C,function(M,K,Q,We,De,Ge){return Q||(Q=We),S+=e.slice(I,Ge).replace(Hu,ql),K&&(g=!0,S+=`' +
__e(`+K+`) +
'`),De&&(m=!0,S+=`';
`+De+`;
__p += '`),Q&&(S+=`' +
((__t = (`+Q+`)) == null ? '' : __t) +
'`),I=Ge+M.length,M}),S+=`';
`;var j=re.call(t,"variable")&&t.variable;if(!j)S=`with (obj) {
`+S+`
}
`;else if(Du.test(j))throw new U(y);S=(m?S.replace(wu,""):S).replace(_u,"$1").replace(bu,"$1;"),S="function("+(j||"obj")+`) {
`+(j?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(g?", __e = _.escape":"")+(m?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+S+`return __p
}`;var H=Vc(function(){return Z(l,N+"return "+S).apply(i,f)});if(H.source=S,Cn(H))throw H;return H}function ov(e){return ee(e).toLowerCase()}function av(e){return ee(e).toUpperCase()}function cv(e,t,s){if(e=ee(e),e&&(s||t===i))return Yo(e);if(!e||!(t=Be(t)))return e;var a=at(e),c=at(t),l=Zo(a,c),f=Xo(a,c)+1;return Ut(a,l,f).join("")}function hv(e,t,s){if(e=ee(e),e&&(s||t===i))return e.slice(0,ta(e)+1);if(!e||!(t=Be(t)))return e;var a=at(e),c=Xo(a,at(t))+1;return Ut(a,0,c).join("")}function uv(e,t,s){if(e=ee(e),e&&(s||t===i))return e.replace(Rs,"");if(!e||!(t=Be(t)))return e;var a=at(e),c=Zo(a,at(t));return Ut(a,c).join("")}function lv(e,t){var s=gs,a=Qe;if(ge(t)){var c="separator"in t?t.separator:c;s="length"in t?V(t.length):s,a="omission"in t?Be(t.omission):a}e=ee(e);var l=e.length;if(ui(e)){var f=at(e);l=f.length}if(s>=l)return e;var g=s-li(a);if(g<1)return a;var m=f?Ut(f,0,g).join(""):e.slice(0,g);if(c===i)return m+a;if(f&&(g+=m.length-g),On(c)){if(e.slice(g).search(c)){var I,P=m;for(c.global||(c=Hs(c.source,ee(wo.exec(c))+"g")),c.lastIndex=0;I=c.exec(P);)var S=I.index;m=m.slice(0,S===i?g:S)}}else if(e.indexOf(Be(c),g)!=g){var C=m.lastIndexOf(c);C>-1&&(m=m.slice(0,C))}return m+a}function pv(e){return e=ee(e),e&&Eu.test(e)?e.replace(yo,Ul):e}var dv=mi(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),Nn=Fa("toUpperCase");function kc(e,t,s){return e=ee(e),t=s?i:t,t===i?Dl(e)?Fl(e):xl(e):e.match(t)||[]}var Vc=B(function(e,t){try{return Fe(e,i,t)}catch(s){return Cn(s)?s:new U(s)}}),fv=St(function(e,t){return Ye(t,function(s){s=gt(s),It(e,s,xn(e[s],e))}),e});function gv(e){var t=e==null?0:e.length,s=L();return e=t?pe(e,function(a){if(typeof a[1]!="function")throw new Ze(d);return[s(a[0]),a[1]]}):[],B(function(a){for(var c=-1;++c<t;){var l=e[c];if(Fe(l[0],this,a))return Fe(l[1],this,a)}})}function yv(e){return Up(et(e,$))}function qn(e){return function(){return e}}function vv(e,t){return e==null||e!==e?t:e}var mv=Ba(),wv=Ba(!0);function Ue(e){return e}function $n(e){return ba(typeof e=="function"?e:et(e,$))}function _v(e){return Ia(et(e,$))}function bv(e,t){return Pa(e,et(t,$))}var Ev=B(function(e,t){return function(s){return Bi(s,e,t)}}),Iv=B(function(e,t){return function(s){return Bi(e,s,t)}});function Dn(e,t,s){var a=Ie(t),c=jr(t,a);s==null&&!(ge(t)&&(c.length||!a.length))&&(s=t,t=e,e=this,c=jr(t,Ie(t)));var l=!(ge(s)&&"chain"in s)||!!s.chain,f=Rt(e);return Ye(c,function(g){var m=t[g];e[g]=m,f&&(e.prototype[g]=function(){var I=this.__chain__;if(l||I){var P=e(this.__wrapped__),S=P.__actions__=je(this.__actions__);return S.push({func:m,args:arguments,thisArg:e}),P.__chain__=I,P}return m.apply(e,$t([this.value()],arguments))})}),e}function Pv(){return xe._===this&&(xe._=Ql),this}function Ln(){}function Sv(e){return e=V(e),B(function(t){return Sa(t,e)})}var xv=dn(pe),Rv=dn(Ko),Cv=dn(js);function Fc(e){return _n(e)?Ms(gt(e)):rd(e)}function Ov(e){return function(t){return e==null?i:Xt(e,t)}}var Av=Wa(),Tv=Wa(!0);function jn(){return[]}function Mn(){return!1}function Nv(){return{}}function qv(){return""}function $v(){return!0}function Dv(e,t){if(e=V(e),e<1||e>ce)return[];var s=Oe,a=Ae(e,Oe);t=L(t),e-=Oe;for(var c=ks(a,t);++s<e;)t(s);return c}function Lv(e){return k(e)?pe(e,gt):Ke(e)?[e]:je(hc(ee(e)))}function jv(e){var t=++Wl;return ee(e)+t}var Mv=Fr(function(e,t){return e+t},0),zv=fn("ceil"),Uv=Fr(function(e,t){return e/t},1),kv=fn("floor");function Vv(e){return e&&e.length?Lr(e,Ue,Zs):i}function Fv(e,t){return e&&e.length?Lr(e,L(t,2),Zs):i}function Hv(e){return Qo(e,Ue)}function Bv(e,t){return Qo(e,L(t,2))}function Kv(e){return e&&e.length?Lr(e,Ue,rn):i}function Wv(e,t){return e&&e.length?Lr(e,L(t,2),rn):i}var Gv=Fr(function(e,t){return e*t},1),Qv=fn("round"),Jv=Fr(function(e,t){return e-t},0);function Yv(e){return e&&e.length?Us(e,Ue):0}function Zv(e,t){return e&&e.length?Us(e,L(t,2)):0}return u.after=_g,u.ary=_c,u.assign=ay,u.assignIn=$c,u.assignInWith=is,u.assignWith=cy,u.at=hy,u.before=bc,u.bind=xn,u.bindAll=fv,u.bindKey=Ec,u.castArray=Ng,u.chain=vc,u.chunk=Ud,u.compact=kd,u.concat=Vd,u.cond=gv,u.conforms=yv,u.constant=qn,u.countBy=Yf,u.create=uy,u.curry=Ic,u.curryRight=Pc,u.debounce=Sc,u.defaults=ly,u.defaultsDeep=py,u.defer=bg,u.delay=Eg,u.difference=Fd,u.differenceBy=Hd,u.differenceWith=Bd,u.drop=Kd,u.dropRight=Wd,u.dropRightWhile=Gd,u.dropWhile=Qd,u.fill=Jd,u.filter=Xf,u.flatMap=ig,u.flatMapDeep=rg,u.flatMapDepth=sg,u.flatten=dc,u.flattenDeep=Yd,u.flattenDepth=Zd,u.flip=Ig,u.flow=mv,u.flowRight=wv,u.fromPairs=Xd,u.functions=wy,u.functionsIn=_y,u.groupBy=ng,u.initial=tf,u.intersection=rf,u.intersectionBy=sf,u.intersectionWith=nf,u.invert=Ey,u.invertBy=Iy,u.invokeMap=ag,u.iteratee=$n,u.keyBy=cg,u.keys=Ie,u.keysIn=ze,u.map=Jr,u.mapKeys=Sy,u.mapValues=xy,u.matches=_v,u.matchesProperty=bv,u.memoize=Zr,u.merge=Ry,u.mergeWith=Dc,u.method=Ev,u.methodOf=Iv,u.mixin=Dn,u.negate=Xr,u.nthArg=Sv,u.omit=Cy,u.omitBy=Oy,u.once=Pg,u.orderBy=hg,u.over=xv,u.overArgs=Sg,u.overEvery=Rv,u.overSome=Cv,u.partial=Rn,u.partialRight=xc,u.partition=ug,u.pick=Ay,u.pickBy=Lc,u.property=Fc,u.propertyOf=Ov,u.pull=hf,u.pullAll=gc,u.pullAllBy=uf,u.pullAllWith=lf,u.pullAt=pf,u.range=Av,u.rangeRight=Tv,u.rearg=xg,u.reject=dg,u.remove=df,u.rest=Rg,u.reverse=Pn,u.sampleSize=gg,u.set=Ny,u.setWith=qy,u.shuffle=yg,u.slice=ff,u.sortBy=wg,u.sortedUniq=bf,u.sortedUniqBy=Ef,u.split=iv,u.spread=Cg,u.tail=If,u.take=Pf,u.takeRight=Sf,u.takeRightWhile=xf,u.takeWhile=Rf,u.tap=Vf,u.throttle=Og,u.thru=Qr,u.toArray=Tc,u.toPairs=jc,u.toPairsIn=Mc,u.toPath=Lv,u.toPlainObject=qc,u.transform=$y,u.unary=Ag,u.union=Cf,u.unionBy=Of,u.unionWith=Af,u.uniq=Tf,u.uniqBy=Nf,u.uniqWith=qf,u.unset=Dy,u.unzip=Sn,u.unzipWith=yc,u.update=Ly,u.updateWith=jy,u.values=bi,u.valuesIn=My,u.without=$f,u.words=kc,u.wrap=Tg,u.xor=Df,u.xorBy=Lf,u.xorWith=jf,u.zip=Mf,u.zipObject=zf,u.zipObjectDeep=Uf,u.zipWith=kf,u.entries=jc,u.entriesIn=Mc,u.extend=$c,u.extendWith=is,Dn(u,u),u.add=Mv,u.attempt=Vc,u.camelCase=Vy,u.capitalize=zc,u.ceil=zv,u.clamp=zy,u.clone=qg,u.cloneDeep=Dg,u.cloneDeepWith=Lg,u.cloneWith=$g,u.conformsTo=jg,u.deburr=Uc,u.defaultTo=vv,u.divide=Uv,u.endsWith=Fy,u.eq=ht,u.escape=Hy,u.escapeRegExp=By,u.every=Zf,u.find=eg,u.findIndex=lc,u.findKey=dy,u.findLast=tg,u.findLastIndex=pc,u.findLastKey=fy,u.floor=kv,u.forEach=mc,u.forEachRight=wc,u.forIn=gy,u.forInRight=yy,u.forOwn=vy,u.forOwnRight=my,u.get=An,u.gt=Mg,u.gte=zg,u.has=by,u.hasIn=Tn,u.head=fc,u.identity=Ue,u.includes=og,u.indexOf=ef,u.inRange=Uy,u.invoke=Py,u.isArguments=ii,u.isArray=k,u.isArrayBuffer=Ug,u.isArrayLike=Me,u.isArrayLikeObject=ve,u.isBoolean=kg,u.isBuffer=kt,u.isDate=Vg,u.isElement=Fg,u.isEmpty=Hg,u.isEqual=Bg,u.isEqualWith=Kg,u.isError=Cn,u.isFinite=Wg,u.isFunction=Rt,u.isInteger=Rc,u.isLength=es,u.isMap=Cc,u.isMatch=Gg,u.isMatchWith=Qg,u.isNaN=Jg,u.isNative=Yg,u.isNil=Xg,u.isNull=Zg,u.isNumber=Oc,u.isObject=ge,u.isObjectLike=ye,u.isPlainObject=Yi,u.isRegExp=On,u.isSafeInteger=ey,u.isSet=Ac,u.isString=ts,u.isSymbol=Ke,u.isTypedArray=_i,u.isUndefined=ty,u.isWeakMap=iy,u.isWeakSet=ry,u.join=of,u.kebabCase=Ky,u.last=it,u.lastIndexOf=af,u.lowerCase=Wy,u.lowerFirst=Gy,u.lt=sy,u.lte=ny,u.max=Vv,u.maxBy=Fv,u.mean=Hv,u.meanBy=Bv,u.min=Kv,u.minBy=Wv,u.stubArray=jn,u.stubFalse=Mn,u.stubObject=Nv,u.stubString=qv,u.stubTrue=$v,u.multiply=Gv,u.nth=cf,u.noConflict=Pv,u.noop=Ln,u.now=Yr,u.pad=Qy,u.padEnd=Jy,u.padStart=Yy,u.parseInt=Zy,u.random=ky,u.reduce=lg,u.reduceRight=pg,u.repeat=Xy,u.replace=ev,u.result=Ty,u.round=Qv,u.runInContext=v,u.sample=fg,u.size=vg,u.snakeCase=tv,u.some=mg,u.sortedIndex=gf,u.sortedIndexBy=yf,u.sortedIndexOf=vf,u.sortedLastIndex=mf,u.sortedLastIndexBy=wf,u.sortedLastIndexOf=_f,u.startCase=rv,u.startsWith=sv,u.subtract=Jv,u.sum=Yv,u.sumBy=Zv,u.template=nv,u.times=Dv,u.toFinite=Ct,u.toInteger=V,u.toLength=Nc,u.toLower=ov,u.toNumber=rt,u.toSafeInteger=oy,u.toString=ee,u.toUpper=av,u.trim=cv,u.trimEnd=hv,u.trimStart=uv,u.truncate=lv,u.unescape=pv,u.uniqueId=jv,u.upperCase=dv,u.upperFirst=Nn,u.each=mc,u.eachRight=wc,u.first=fc,Dn(u,function(){var e={};return dt(u,function(t,s){re.call(u.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),u.VERSION=n,Ye(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){u[e].placeholder=u}),Ye(["drop","take"],function(e,t){W.prototype[e]=function(s){s=s===i?1:Ee(V(s),0);var a=this.__filtered__&&!t?new W(this):this.clone();return a.__filtered__?a.__takeCount__=Ae(s,a.__takeCount__):a.__views__.push({size:Ae(s,Oe),type:e+(a.__dir__<0?"Right":"")}),a},W.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),Ye(["filter","map","takeWhile"],function(e,t){var s=t+1,a=s==_||s==F;W.prototype[e]=function(c){var l=this.clone();return l.__iteratees__.push({iteratee:L(c,3),type:s}),l.__filtered__=l.__filtered__||a,l}}),Ye(["head","last"],function(e,t){var s="take"+(t?"Right":"");W.prototype[e]=function(){return this[s](1).value()[0]}}),Ye(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");W.prototype[e]=function(){return this.__filtered__?new W(this):this[s](1)}}),W.prototype.compact=function(){return this.filter(Ue)},W.prototype.find=function(e){return this.filter(e).head()},W.prototype.findLast=function(e){return this.reverse().find(e)},W.prototype.invokeMap=B(function(e,t){return typeof e=="function"?new W(this):this.map(function(s){return Bi(s,e,t)})}),W.prototype.reject=function(e){return this.filter(Xr(L(e)))},W.prototype.slice=function(e,t){e=V(e);var s=this;return s.__filtered__&&(e>0||t<0)?new W(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==i&&(t=V(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},W.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},W.prototype.toArray=function(){return this.take(Oe)},dt(W.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),a=/^(?:head|last)$/.test(t),c=u[a?"take"+(t=="last"?"Right":""):t],l=a||/^find/.test(t);c&&(u.prototype[t]=function(){var f=this.__wrapped__,g=a?[1]:arguments,m=f instanceof W,I=g[0],P=m||k(f),S=function(K){var Q=c.apply(u,$t([K],g));return a&&C?Q[0]:Q};P&&s&&typeof I=="function"&&I.length!=1&&(m=P=!1);var C=this.__chain__,N=!!this.__actions__.length,j=l&&!C,H=m&&!N;if(!l&&P){f=H?f:new W(this);var M=e.apply(f,g);return M.__actions__.push({func:Qr,args:[S],thisArg:i}),new Xe(M,C)}return j&&H?e.apply(this,g):(M=this.thru(S),j?a?M.value()[0]:M.value():M)})}),Ye(["pop","push","shift","sort","splice","unshift"],function(e){var t=br[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);u.prototype[e]=function(){var c=arguments;if(a&&!this.__chain__){var l=this.value();return t.apply(k(l)?l:[],c)}return this[s](function(f){return t.apply(k(f)?f:[],c)})}}),dt(W.prototype,function(e,t){var s=u[t];if(s){var a=s.name+"";re.call(gi,a)||(gi[a]=[]),gi[a].push({name:t,func:s})}}),gi[Vr(i,ae).name]=[{name:"wrapper",func:i}],W.prototype.clone=lp,W.prototype.reverse=pp,W.prototype.value=dp,u.prototype.at=Ff,u.prototype.chain=Hf,u.prototype.commit=Bf,u.prototype.next=Kf,u.prototype.plant=Gf,u.prototype.reverse=Qf,u.prototype.toJSON=u.prototype.valueOf=u.prototype.value=Jf,u.prototype.first=u.prototype.head,Mi&&(u.prototype[Mi]=Wf),u},pi=Hl();Gt?((Gt.exports=pi)._=pi,qs._=pi):xe._=pi}).call(ir)})(eo,eo.exports);var n0=Object.defineProperty,o0=Object.defineProperties,a0=Object.getOwnPropertyDescriptors,Oh=Object.getOwnPropertySymbols,c0=Object.prototype.hasOwnProperty,h0=Object.prototype.propertyIsEnumerable,Ah=(p,r,i)=>r in p?n0(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,ns=(p,r)=>{for(var i in r||(r={}))c0.call(r,i)&&Ah(p,i,r[i]);if(Oh)for(var i of Oh(r))h0.call(r,i)&&Ah(p,i,r[i]);return p},u0=(p,r)=>o0(p,a0(r));function Ri(p,r,i){var n;const o=Bm(p);return((n=r.rpcMap)==null?void 0:n[o.reference])||`${s0}?chainId=${o.namespace}:${o.reference}&projectId=${i}`}function ni(p){return p.includes(":")?p.split(":")[1]:p}function hu(p){return p.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function l0(p,r){const i=Object.keys(r.namespaces).filter(o=>o.includes(p));if(!i.length)return[];const n=[];return i.forEach(o=>{const h=r.namespaces[o].accounts;n.push(...h)}),n}function p0(p={},r={}){const i=Th(p),n=Th(r);return eo.exports.merge(i,n)}function Th(p){var r,i,n,o;const h={};if(!cs(p))return h;for(const[d,y]of Object.entries(p)){const b=Fh(d)?[d]:y.chains,x=y.methods||[],q=y.events||[],$=y.rpcMap||{},D=rr(d);h[D]=u0(ns(ns({},h[D]),y),{chains:Un(b,(r=h[D])==null?void 0:r.chains),methods:Un(x,(i=h[D])==null?void 0:i.methods),events:Un(q,(n=h[D])==null?void 0:n.events),rpcMap:ns(ns({},$),(o=h[D])==null?void 0:o.rpcMap)})}return h}function d0(p){return p.includes(":")?p.split(":")[2]:p}function f0(p){const r={};for(const[i,n]of Object.entries(p)){const o=n.methods||[],h=n.events||[],d=n.accounts||[],y=Fh(i)?[i]:n.chains?n.chains:hu(n.accounts);r[i]={chains:y,methods:o,events:h,accounts:d}}return r}function Kn(p){return typeof p=="number"?p:p.includes("0x")?parseInt(p,16):p.includes(":")?Number(p.split(":")[1]):Number(p)}const uu={},we=p=>uu[p],Wn=(p,r)=>{uu[p]=r};class g0{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=ni(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ri(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Kt(new si(n,we("disableProviderPing")))}}class y0{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=we("events"),this.client=we("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(parseInt(r),i),this.chainId=parseInt(r),this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,i){const n=i||Ri(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Kt(new si(n,we("disableProviderPing")))}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=parseInt(ni(i));r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}async handleSwitchChain(r){var i,n;let o=r.request.params?(i=r.request.params[0])==null?void 0:i.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const h=parseInt(o,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class v0{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=ni(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ri(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Kt(new si(n,we("disableProviderPing")))}}class m0{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=ni(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ri(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Kt(new si(n,we("disableProviderPing")))}}class w0{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{const n=this.getCardanoRPCUrl(i),o=ni(i);r[o]=this.createHttpProvider(o,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}getCardanoRPCUrl(r){const i=this.namespace.rpcMap;if(i)return i[r]}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Kt(new si(n,we("disableProviderPing")))}}class _0{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=ni(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ri(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Kt(new si(n,we("disableProviderPing")))}}class b0{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(Wt.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=ni(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Ri(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new Kt(new si(n,we("disableProviderPing")))}}var E0=Object.defineProperty,I0=Object.defineProperties,P0=Object.getOwnPropertyDescriptors,Nh=Object.getOwnPropertySymbols,S0=Object.prototype.hasOwnProperty,x0=Object.prototype.propertyIsEnumerable,qh=(p,r,i)=>r in p?E0(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,os=(p,r)=>{for(var i in r||(r={}))S0.call(r,i)&&qh(p,i,r[i]);if(Nh)for(var i of Nh(r))x0.call(r,i)&&qh(p,i,r[i]);return p},Gn=(p,r)=>I0(p,P0(r));class lo{constructor(r){this.events=new ao,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:Y.pino(Y.getDefaultLoggerOptions({level:r?.logger||Rh})),this.disableProviderPing=r?.disableProviderPing||!1}static async init(r){const i=new lo(r);return await i.initialize(),i}async request(r,i){const[n,o]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:os({},r),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(r,i,n){this.request(r,n).then(o=>i(null,o)).catch(o=>i(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:Le("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}removeListener(r,i){this.events.removeListener(r,i)}off(r,i){this.events.off(r,i)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let i=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(i>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(h=>{this.session=h,this.namespaces||(this.namespaces=f0(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==au)throw h;i++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,i){try{if(!this.session)return;const[n,o]=this.validateChain(r);this.getProvider(n).setDefaultChain(o,i)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(Si(i)){for(const n of i)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Qb.init({logger:this.providerOpts.logger||Rh,relayUrl:this.providerOpts.relayUrl||t0,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(i=>rr(i)))];Wn("client",this.client),Wn("events",this.events),Wn("disableProviderPing",this.disableProviderPing),r.forEach(i=>{if(!this.session)return;const n=l0(i,this.session),o=hu(n),h=p0(this.namespaces,this.optionalNamespaces),d=Gn(os({},h[i]),{accounts:n,chains:o});switch(i){case"eip155":this.rpcProviders[i]=new y0({namespace:d});break;case"solana":this.rpcProviders[i]=new v0({namespace:d});break;case"cosmos":this.rpcProviders[i]=new m0({namespace:d});break;case"polkadot":this.rpcProviders[i]=new g0({namespace:d});break;case"cip34":this.rpcProviders[i]=new w0({namespace:d});break;case"elrond":this.rpcProviders[i]=new _0({namespace:d});break;case"multiversx":this.rpcProviders[i]=new b0({namespace:d});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:i}=r,{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&Si(o)&&this.events.emit("accountsChanged",o.map(d0))}else if(n.name==="chainChanged"){const o=i.chainId,h=i.event.data,d=rr(o),y=Kn(o)!==Kn(h)?`${d}:${Kn(h)}`:o;this.onChainChanged(y)}else this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:i})=>{var n;const{namespaces:o}=i,h=(n=this.client)==null?void 0:n.session.get(r);this.session=Gn(os({},h),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:i})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",Gn(os({},Le("USER_DISCONNECTED")),{data:r.topic}))}),this.on(Wt.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var i;this.getProvider(r).updateNamespace((i=this.session)==null?void 0:i.namespaces[r])})}setNamespaces(r){const{namespaces:i,optionalNamespaces:n,sessionProperties:o}=r;i&&Object.keys(i).length&&(this.namespaces=i),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",i),this.persist("optionalNamespaces",n)}validateChain(r){const[i,n]=r?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,n];if(i&&!Object.keys(this.namespaces||{}).map(d=>rr(d)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&n)return[i,n];const o=rr(Object.keys(this.namespaces)[0]),h=this.rpcProviders[o].getDefaultChain();return[o,h]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,i=!1){var n;if(!this.namespaces)return;const[o,h]=this.validateChain(r);i||this.getProvider(o).setDefaultChain(h),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,i){this.client.core.storage.setItem(`${Ch}/${r}`,i)}async getFromStore(r){return await this.client.core.storage.getItem(`${Ch}/${r}`)}}const R0=lo,C0="wc",O0="ethereum_provider",A0=`${C0}@2:${O0}:`,T0="https://rpc.walletconnect.com/v1/",to=["eth_sendTransaction","personal_sign"],N0=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],io=["chainChanged","accountsChanged"],q0=["chainChanged","accountsChanged","message","disconnect","connect"];var $0=Object.defineProperty,D0=Object.defineProperties,L0=Object.getOwnPropertyDescriptors,$h=Object.getOwnPropertySymbols,j0=Object.prototype.hasOwnProperty,M0=Object.prototype.propertyIsEnumerable,Dh=(p,r,i)=>r in p?$0(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,or=(p,r)=>{for(var i in r||(r={}))j0.call(r,i)&&Dh(p,i,r[i]);if($h)for(var i of $h(r))M0.call(r,i)&&Dh(p,i,r[i]);return p},Lh=(p,r)=>D0(p,L0(r));function ls(p){return Number(p[0].split(":")[1])}function Qn(p){return`0x${p.toString(16)}`}function z0(p){const{chains:r,optionalChains:i,methods:n,optionalMethods:o,events:h,optionalEvents:d,rpcMap:y}=p;if(!Si(r))throw new Error("Invalid chains");const b={chains:r,methods:n||to,events:h||io,rpcMap:or({},r.length?{[ls(r)]:y[ls(r)]}:{})},x=h?.filter(G=>!io.includes(G)),q=n?.filter(G=>!to.includes(G));if(!i&&!d&&!o&&!(x!=null&&x.length)&&!(q!=null&&q.length))return{required:r.length?b:void 0};const $=x?.length&&q?.length||!i,D={chains:[...new Set($?b.chains.concat(i||[]):i)],methods:[...new Set(b.methods.concat(o!=null&&o.length?o:N0))],events:[...new Set(b.events.concat(d!=null&&d.length?d:q0))],rpcMap:y};return{required:r.length?b:void 0,optional:i.length?D:void 0}}class po{constructor(){this.events=new mt.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=A0,this.on=(r,i)=>(this.events.on(r,i),this),this.once=(r,i)=>(this.events.once(r,i),this),this.removeListener=(r,i)=>(this.events.removeListener(r,i),this),this.off=(r,i)=>(this.events.off(r,i),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const i=new po;return await i.initialize(r),i}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,i){this.signer.sendAsync(r,i,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:i,optional:n}=z0(this.rpc);try{const o=await new Promise(async(d,y)=>{var b;this.rpc.showQrModal&&((b=this.modal)==null||b.subscribeModal(x=>{!x.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Lh(or({namespaces:or({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r?.pairingTopic})).then(x=>{d(x)}).catch(x=>{y(new Error(x.message))})});if(!o)return;const h=Km(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:Qn(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:i}=r,{event:n}=i;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const i=parseInt(r);this.chainId=i,this.events.emit("chainChanged",Qn(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",Lh(or({},Le("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var i,n;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const i=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",Qn(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const i=this.parseChainId(r);this.chainId=i,this.switchEthereumChain(i)}}parseAccountId(r){const[i,n,o]=r.split(":");return{chainId:`${i}:${n}`,address:o}}setAccounts(r){this.accounts=r.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var i,n;const o=(i=r?.chains)!=null?i:[],h=(n=r?.optionalChains)!=null?n:[],d=o.concat(h);if(!d.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=o.length?r?.methods||to:[],b=o.length?r?.events||io:[],x=r?.optionalMethods||[],q=r?.optionalEvents||[],$=r?.rpcMap||this.buildRpcMap(d,r.projectId),D=r?.qrModalOptions||void 0;return{chains:o?.map(G=>this.formatChainId(G)),optionalChains:h.map(G=>this.formatChainId(G)),methods:y,events:b,optionalMethods:x,optionalEvents:q,rpcMap:$,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:D,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,i){const n={};return r.forEach(o=>{n[o]=this.getRpcUrl(o,i)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?ls(this.rpc.chains):ls(this.rpc.optionalChains),this.signer=await R0.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const{WalletConnectModal:n}=await Wm(()=>import("./index-C1pA6XZz.js").then(o=>o.i),__vite__mapDeps([0,1,2]));i=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(i)try{this.modal=new i(or({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:i,optionalChains:n,rpcMap:o}=r;i&&Si(i)&&(this.rpc.chains=i.map(h=>this.formatChainId(h)),i.forEach(h=>{this.rpc.rpcMap[h]=o?.[h]||this.getRpcUrl(h)})),n&&Si(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n?.map(h=>this.formatChainId(h)),n.forEach(h=>{this.rpc.rpcMap[h]=o?.[h]||this.getRpcUrl(h)}))}getRpcUrl(r,i){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${T0}?chainId=eip155:${r}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),i=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:i?.accounts),this.setAccounts(i?.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(i=>this.parseAccount(i))}}const G0=po;export{G0 as EthereumProvider,q0 as OPTIONAL_EVENTS,N0 as OPTIONAL_METHODS,io as REQUIRED_EVENTS,to as REQUIRED_METHODS,po as default};
